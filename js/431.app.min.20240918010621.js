"use strict";(self.webpackChunkgulp2024=self.webpackChunkgulp2024||[]).push([[431],{431:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var r=s(47);function o(e,t=!1){return`\n  <div class="warehouse__rooms_room room-warehouse ${t?"_selected":""}" data-room-id="${e.room_id&&e.room_id}" data-warehouse-id="${e.warehouse_id&&e.warehouse_id}">\n    <div class="warehouse__rooms_room-content">\n      <span class="warehouse__rooms_room-num">${e.room_name?"№"+e.room_name:""}</span>\n      <span class="warehouse__rooms_room-area">${e.volume?e.volume+" м<sup>3</sup>":""}</span>\n      <div class="warehouse__rooms_room-block dimensions">\n        <span>размер кладовки</span>\n        <b>${e.dimensions?e.dimensions+" м":""}</b>\n      </div>\n      <div class="warehouse__rooms_room-block floor">\n        <span>ярус</span>\n        <b>${e.floor?e.floor:""}</b>\n      </div>\n    </div>\n    <a href="${location.origin}/calculator/${e.warehouse_id}/room-${e.room_name}.html" class="warehouse__rooms_room-link button link-rent-storage-room">\n      <span>${e.price_11m?"от "+(0,r.F)(e.price_11m):""}</span>\n    </a>\n  </div>`}var a=s(514);const i=(e,t)=>{const s=e.value.replace(/[^0-9]/g,"");return e.value.length>t.toString().length?e.value=e.value.slice(0,t.toString().length):Number(s)>Number(t)?e.value=t:e.value=s,s.length<=t.toString().length},n=(e,t)=>{const s=e.value&&e.value.replace(/[^0-9.]/g,"");if(!s)return!1;const r=s.indexOf(".");if(-1!==r){const t=s.slice(0,r+2);return e.value=t.replace(/,/g,"."),!0}return Number(s)>Number(t)?e.value=t:e.value=s,!0};function l(e){return Number(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}class h{constructor(e,t){this.options=Object.assign({onChange:()=>{},onInit:()=>{},selectorInput:""},t),this.ranges=document.querySelectorAll(e),this.inputs=document.querySelectorAll(this.options.selectorInput),this.timerRange=null,this.slidersFormat={volume:{to:e=>`${e.toFixed(0)}м<sup>3</sup>`,from:e=>parseFloat(e)},duration:{to:e=>`${e.toFixed(0)}м`,from:e=>parseFloat(e)}},this.rangeStartData={volume_start:1,volume_end:17,price_start:1,price_end:22e3},this.rangeData={...this.rangeStartData,volume_end:16,price_end:1e6},this.areaDifference=this.rangeStartData.volume_end-this.rangeData.volume_end,this.rangeInputsValidate={volume_start:e=>n(e,this.rangeStartData.volume_end-this.areaDifference),volume_end:e=>n(e,this.rangeStartData.volume_end-this.areaDifference),price_start:e=>i(e,this.rangeStartData.price_end),price_end:e=>i(e,this.rangeStartData.price_end)},this.init()}init(){if(!this.ranges.length)return console.error("range нет");this.sliders={},this.ranges.forEach((e=>{const t=e.getAttribute("data-type-range"),s=noUiSlider.create(e,{start:[this.rangeStartData[`${t}_start`],this.rangeStartData[`${t}_end`]],connect:!0,step:1,range:{min:this.rangeStartData[`${t}_start`],max:this.rangeStartData[`${t}_end`]},margin:1,pips:{mode:"count",values:"volume"===t?this.rangeStartData[`${t}_end`]:2,density:100,stepped:!0}});if("volume"===t){const t=e.querySelectorAll(".noUi-value");t.length&&t.forEach(((e,s)=>{e.innerHTML=0===s?"1<span>м³</span>":1===s?"1.5<span>м³</span>":+e.textContent-this.areaDifference+"<span>м³</span>",t.length-1===s&&(e.classList.add("_last"),e.innerHTML=e.innerHTML+"+")}))}else if("price"===t){const t=e.querySelectorAll(".noUi-value");t.length&&t.forEach(((e,s)=>{e.textContent=l(e.textContent),t.length-1===s&&(e.classList.add("_last"),e.innerHTML=e.innerHTML+"+")}))}this.sliders[t]=s,this.createHtmlTooltip(e)}));for(let e in this.sliders)this.sliders.hasOwnProperty(e)&&(this.sliders[e].on("slide",((e,t,s,r,o,a)=>this.rangeSlide({values:e,handle:t,unencoded:s,tap:r,positions:o,noUiSlider:a}))),this.sliders[e].on("change",((e,t,s)=>this.rangeChange(e,t,s))));this.handleInput(),this.options.onInit(this.sliders)}rangeSlide({values:e,handle:t,unencoded:s,noUiSlider:r}){const o=r.target.getAttribute("data-type-range"),a=document.querySelectorAll(`${this.options.selectorInput}[data-type-range="${o}"]`),i=a[t].closest("label"),n=Number(s[t].toFixed(0)),h=a[t].parentElement.querySelector(".type");if(i.style.borderColor="#000",a[t].classList.add("_focus"),"volume"===o)if(1===n||2==n){const e=2==n?1.5:1;this.rangeData[a[t].name]=e,a[t].value=e,h.textContent="м³"}else this.rangeData[a[t].name]=n-this.areaDifference,a[t].value=n-this.areaDifference,h.textContent="м³";else"price"===o?(a[t].value=l(n),this.rangeData[a[t].name]=n):(this.rangeData[a[t].name]=n,a[t].value=n);clearTimeout(this.timerRange),this.timerRange=setTimeout((()=>{a[t].classList.remove("_focus")}),500)}rangeChange(e,t,s){16===this.rangeData.volume_end&&(this.rangeData.volume_end=1e3),this.rangeData.price_end===this.rangeStartData.price_end&&(this.rangeData.price_end=1e6),this.options.onChange(this.rangeData,e,t,s)}handleInput(){this.inputs.length&&this.inputs.forEach((e=>{e.addEventListener("input",(()=>{const t=e.closest("label"),s=e.getAttribute("data-type-range"),r=e.name.split("_").at(-1),o="start"===r?0:1,i=this.sliders[s];let n=function(e){return e.map((e=>parseFloat(e.replace(/\s/g,"").replace(/ /g,""))))}(i.get());this.rangeInputsValidate[e.name](e),this.rangeData[e.name]=Number(e.value),clearTimeout(this.timerRange),this.timerRange=setTimeout((()=>{const[l]=Array.from(this.inputs).filter((t=>s===t.getAttribute("data-type-range")&&t!==e));if("start"===r){if(+e.value>=+l.value.replace(/\s/g,""))return t.style.borderColor="red",void(0,a.G)({msg:"Начальное значение не может быть больше или равно конечному",msg_type:"warning"})}else if(+e.value<=+l.value.replace(/\s/g,""))return t.style.borderColor="red",void(0,a.G)({msg:"Конечное значение не может быть меньше или равно начальному",msg_type:"warning"});t.style.borderColor="#000","volume"===s?1==+e.value?n[o]=1:1.5==+e.value?n[o]=2:n[o]=+e.value+this.areaDifference:n[o]=+e.value,i.set(n),this.rangeChange()}),500)}))}))}updateInputValue(e,t){const s=document.querySelectorAll(`${this.options.selectorInput}[data-type-range="${e}"]`);let[r,o]=t;const a=e+"_start",i=e+"_end";r||(r=this.rangeStartData[a]),o||(o=this.rangeStartData[i]),t=[r,o],s.length&&s.forEach(((s,a)=>{const i=s.parentElement.querySelector(".type"),n=Number((+t[a]).toFixed(0));"volume"===e?1==+r&&1.5==+o||1.5==+o?(s.value=1==n?1:1.5,i.textContent="м³"):(s.value=n||"",i.textContent="м³"):s.value=n||""}))}createHtmlTooltip(e){const t=e.querySelectorAll(".noUi-handle");t&&t.length&&t.forEach((e=>{e.insertAdjacentHTML("beforeend",'\n      <div class="range-tooltip">\n        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">\n          <circle cx="14" cy="14" r="12" fill="#F5F5F5" />\n          <path d="M14 28C21.7 28 28 21.7 28 14C28 6.3 21.7 0 14 0C6.3 0 0 6.3 0 14C0 21.7 6.3 28 14 28ZM14 25.2C9.66 25.2 5.74 22.68 3.92 18.9L10.64 16.52C11.48 17.64 12.74 18.2 14 18.2C15.26 18.2 16.52 17.64 17.22 16.66L24.08 18.9C22.26 22.68 18.34 25.2 14 25.2ZM15.4 2.94C20.86 3.64 25.2 8.4 25.2 14C25.2 14.84 25.06 15.54 24.92 16.38L18.2 14C18.2 12.18 17.08 10.64 15.4 10.08L15.4 2.94ZM14 12.6C14.84 12.6 15.4 13.16 15.4 14C15.4 14.84 14.84 15.4 14 15.4C13.16 15.4 12.6 14.84 12.6 14C12.6 13.16 13.16 12.6 14 12.6ZM12.6 2.94L12.6 10.08C10.92 10.64 9.8 12.18 9.8 14L3.08 16.38C2.94 15.54 2.8 14.84 2.8 14C2.8 8.26 7.14 3.64 12.6 2.94Z" fill="#2D3A3D" />\n        </svg>\n      </div>')}))}setSlider(e,t){let[s,r]=t;const o=e+"_start",a=e+"_end";let i=!0;s||(i=!1,s=this.rangeStartData[o]),r||(r=this.rangeData[a]),"volume"===e?1==+s&&1.5==+r?this.sliders[e].set([1,2]):this.sliders[e].set([i?+s+this.areaDifference:+s,+r+this.areaDifference]):this.sliders[e].set([+s,+r]),this.rangeData[o]=+s,this.rangeData[a]=+r}}var u=s(325),c=s(922),m=s(212),d=s(417),g=s(700),p=s(543),_=s(337);const v=class{constructor(){this.warehouse=document.querySelector(".warehouse"),this.warehouse&&(this.urlParams=new URLSearchParams(this.getSearchParams()),this.warehouseId=+this.warehouse.getAttribute("data-warehouse-id"),this.depth=location.pathname.split("/").filter((e=>e)).length-1,this.pathPrefix=this.depth>0?"../".repeat(this.depth):"",this.warehouseId&&(this.slider=this.initSlider(),this.tabsScheme=new u.t("tabs-warehouse",{btnSelector:".tabs-btn-schemes",contentSelector:".tabs-content-schemes"}),this.range=new h(".range-filter-warehouse",{selectorInput:".input-filter-warehouse",warehouse_id:this.warehouseId}),this.loader=new c.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed"}),this.schemeOne=this.warehouse.querySelector(".scheme-1"),this.schemeTwo=this.warehouse.querySelector(".scheme-2"),this.schemeActive=this.schemeOne,this.contentRoomsWarehouse=this.warehouse.querySelector(".content-rooms-warehouse"),this.infoResultWarehouse=this.warehouse.querySelector(".info-result-warehouse"),this.linkResultWarehouse=this.warehouse.querySelector(".link-result-warehouse"),this.buttonResultWarehouse=this.warehouse.querySelector(".button-result-warehouse"),this.rooms=[],this.resultRoomsData={volume:0,price_11m:0,ids:[],count_rooms:0,rooms:[]},this.pathContent=document.querySelector(".path-content"),this.init()))}getSearchParams(){let e=null;return location.href.includes("?")&&([e=null]=location.href.split("?")?.[1]?.split("#")),e}initSlider(){return new Swiper(".slider-warehouse",{slidesPerView:1,observeSlideChildren:!0,observer:!0,loop:!0,navigation:{nextEl:".warehouse__slider-btn.btn-slider-next",prevEl:".warehouse__slider-btn.btn-slider-prev"}})}init(){const e=+this.urlParams.get("volume_start"),t=+this.urlParams.get("volume_end"),s=+this.urlParams.get("price_start"),r=+this.urlParams.get("price_end");this.range.setSlider("volume",[e,t]),this.range.setSlider("price",[s,r]),this.range.updateInputValue("volume",[e,t]),this.range.updateInputValue("price",[s,r]),this.reqData={...this.range.rangeData,warehouse_id:this.warehouseId,floor:1},this.events(),this.process()}events(){this.tabsScheme.options.onChange=(e,t,s,r)=>{this.schemeActive=s.classList.contains("content-schemes-one")?this.schemeOne:this.schemeTwo,this.reqData.floor=this.schemeActive===this.schemeOne?1:2,this.process((0,d.D)(this.reqData))},this.range.options.onChange=e=>{this.reqData={...this.reqData,floor:this.reqData.floor,...e},this.process((0,d.D)(this.reqData))},this.warehouse.addEventListener("click",(e=>{if((0,_.N)(),e.target.closest(".warehouse__svg-cell")&&e.preventDefault(),e.target.closest(".warehouse__svg-cell.free")&&(e.preventDefault(),this.rooms.length&&this.handlerClickSvgCell(e,this.rooms)),e.target.closest(".link-result-warehouse")&&!this.resultRoomsData.ids.length&&e.preventDefault(),e.target.closest(".warehouse__filter_tab")){const t=e.target.closest(".warehouse__filter_tab"),s=t.getAttribute("data-type-range"),r=t.getAttribute("data-va")?.split(",");if(!s||!r?.length)return;this.range.setSlider(s,r),this.range.updateInputValue(s,r),16===this.range.rangeData.volume_end&&(this.range.rangeData.volume_end=100),this.range.rangeData.price_end===this.range.rangeStartData.price_end&&(this.range.rangeData.price_end=1e5),this.reqData={...this.reqData,floor:this.reqData.floor,...this.range.rangeData},10==+r[0]&&(this.reqData.area_start=10,delete this.reqData.area_end),this.process((0,d.D)(this.reqData))}e.target.closest(".room-warehouse")&&!e.target.closest(".warehouse__rooms_room-link")&&this.rooms.length&&this.handlerClickSvgCell(e,this.rooms)}))}renderWarehouses(e){if(!e.length||!this.warehouse||!this.warehouseId)return;const[t]=e.filter((e=>+e.warehouse_id===this.warehouseId));this.reqData.warehouse_id=t.warehouse_id}renderScheme(e,t){this.warehouse.querySelectorAll(".warehouse__svg-cell")?.forEach((e=>{e.classList.remove("free","busy","disabled","_selected","select-size")})),e.length&&e.forEach((e=>{const t=this.warehouse.querySelector(`.warehouse__svg-cell[data-cell-num="${e.room_name}"]`);t&&(t.setAttribute("data-rented",e.rented),t.setAttribute("data-room-id",e.room_id),t.classList.add("select-size"))})),t.length&&t.forEach((e=>{const t=this.warehouse.querySelector(`.warehouse__svg-cell[data-cell-num="${e.room_name}"]`);t&&(t.setAttribute("data-rented",e.rented),t.setAttribute("data-room-id",e.room_id),t.classList.add(0==+e.rented?"free":"disabled"))}))}renderRooms(e){e.length||2===this.warehouseId?(e.forEach((e=>{this.contentRoomsWarehouse.insertAdjacentHTML("beforeend",o(e))})),(0,p.B)(".warehouse__rooms_room-num",{breakpointsNone:576}),(0,p.B)(".warehouse__rooms_room-area",{breakpoints:[1215,576]}),(0,p.B)(".warehouse__rooms_room-block.dimensions",{breakpoints:[1215,576]}),(0,p.B)(".warehouse__rooms_room-link",{breakpoints:[576,370]})):this.contentRoomsWarehouse.innerHTML='<div class="not-filtered-rooms"><span>Нет свободных ячеек по заданным параметрам</span></div>'}async process(e=(0,d.D)(this.reqData)){try{this.loader.enable();const t=await m.Ay.get(`/_update_floor_for_client_${e}`);if(200!==t.status)return;const{filtered_rooms:s,rooms:r}=t.data;if(!r)return;this.rooms=r,this.renderScheme(s,r),this.renderRooms(s),this.resultRoomsData.rooms.length&&this.resultRoomsData.rooms.forEach((e=>{const t=this.warehouse.querySelector(`.warehouse__svg-cell[data-room-id="${e.room_name}"]`),s=this.warehouse.querySelector(`.room-warehouse[data-room-id="${e.room_name}"]`);t&&t.classList.add("_selected"),s&&(s.remove(),this.contentRoomsWarehouse.insertAdjacentHTML("afterbegin",o(e,!0)))}))}catch(e){throw console.error(e),e}finally{this.loader.disable()}}handlerClickSvgCell(e,t){const s=+e.target.closest("[data-room-id]").getAttribute("data-room-id");if(!s)return;const o=this.warehouse.querySelector(`.warehouse__svg-cell[data-room-id="${s}"]`),a=this.warehouse.querySelector(`.room-warehouse[data-room-id="${s}"]`),[i]=t.filter((e=>+e.room_id===s));if(!i)return void console.error("Ячейка не найдена");const n=o&&o.classList.contains("_selected"),l=n?-i.volume:i.volume,h=n?-i.price_11m:i.price_11m;o?.classList.toggle("_selected",!n),a?.classList.toggle("_selected",!n),n?(a?.classList.remove("_selected"),this.resultRoomsData.ids=this.resultRoomsData.ids.filter((e=>e!==i.room_id)),this.resultRoomsData.rooms=this.resultRoomsData.rooms.filter((e=>+e.room_id!=+i.room_id)),this.resultRoomsData.count_rooms-=1):(this.warehouse.querySelector(".not-filtered-rooms")?.remove(),a?.remove(),this.contentRoomsWarehouse.prepend(a),this.resultRoomsData.ids.push(i.room_id),this.resultRoomsData.rooms.push(i),this.resultRoomsData.count_rooms+=1),this.resultRoomsData.volume=+(this.resultRoomsData.volume+l).toFixed(1),this.resultRoomsData.price_11m=+(this.resultRoomsData.price_11m+h).toFixed(0),1==this.resultRoomsData.count_rooms?(this.buttonResultWarehouse.setAttribute("data-room-id",this.resultRoomsData.ids[0]),this.buttonResultWarehouse.classList.remove("_none")):(this.buttonResultWarehouse.setAttribute("data-room-id",""),this.buttonResultWarehouse.classList.add("_none")),this.infoResultWarehouse.innerHTML=`<span>${this.resultRoomsData.volume} м<sup>3</sup></span><span>от ${(0,r.F)(this.resultRoomsData.price_11m)}</span>`,this.linkResultWarehouse.innerHTML=`<span>Арендовать ${this.resultRoomsData.count_rooms}\n    ${(0,g.Y)(this.resultRoomsData.count_rooms,["кладовку","кладовки","кладовок"])}</span>`,this.linkResultWarehouse.href=`${location.origin}/rent-room.html?ids=${encodeURIComponent(JSON.stringify(this.resultRoomsData.ids))}`,document.querySelector(".warehouse__rooms").scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((()=>{this.contentRoomsWarehouse.scrollTo({top:0,left:0,behavior:"smooth"})}),600)}scrollToRoom(e){this.contentRoomsWarehouse.scrollHeight>=this.contentRoomsWarehouse.offsetHeight&&e&&this.contentRoomsWarehouse.scrollTo({top:e.offsetTop-this.contentRoomsWarehouse.offsetTop,left:0,behavior:"smooth"})}}}}]);