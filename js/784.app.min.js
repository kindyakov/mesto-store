"use strict";(self.webpackChunkgulp2024=self.webpackChunkgulp2024||[]).push([[784,1,255],{194:(e,t,r)=>{function s(e){return`<label class="payment-cards__card">\n                    <span>${e.bank?e.bank:""} ${e.rs?e.rs:""}</span>\n                    <p>Основной способ</p>\n                    <input type="radio" name="requisites" class="rent-room__payment_input-radio input-radio"\n                      id="card-payment-${e.requisites_id?`${e.requisites_id}-${(new Date).getTime()}`:""}" value="${e.requisites_id?e.requisites_id:""}">\n                    <label for="card-payment-${e.requisites_id?`${e.requisites_id}-${(new Date).getTime()}`:""}" class="rent-room__payment_label label-radio"></label>\n                  </label>`}r.d(t,{O:()=>s})},1:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var s=r(922),i=r(212),n=r(514),a=r(320);const o=class{constructor(e){this.options=Object.assign({wrapperSelector:".content-authorization",redirect:null,onAuth:()=>{}},e),this.wrapper=document.querySelector(this.options.wrapperSelector),this.urlParams=new URLSearchParams(window.location.search),this.form=document.querySelector(".form-authorization"),this.form&&(this.validator=(0,a.V)(this.form),this.loader=new s.a(this.wrapper),this.isAuth=!1,this.resData=null,this.username=this.urlParams.get("username"),this.username&&(this.form.querySelector('input[name="username"]').value=this.username.slice(1)),this.events())}events(){this.form&&this.form.addEventListener("submit",this.submit.bind(this))}submit(){if(!this.validator.isValid)return;const e=new FormData(this.form);e.set("username",e.get("username").replace(/[+() -]/g,"")),this.auth(e)}async auth(e){try{this.loader.enable();const t=await i.Ay.post("/_login_",e);if(200!==t.status)return;const{msg:r,msg_type:s,access_token:a,expiration_time:o}=this.resData=t.data;(0,n.G)(t.data),"success"===s&&(this.isAuth=!0,document.cookie=`token=Bearer ${a}; max-age=${o}; path=/`,this.options.onAuth(),this.options.redirect&&(document.location.pathname=this.options.redirect))}catch(e){console.error("Ошибка при регистрации",e.message)}finally{this.loader.disable()}}}},255:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var s=r(922),i=r(212),n=r(514),a=r(304),o=r(320);const l=class{constructor(e){this.options=Object.assign({wrapperSelector:".content-registration",redirect:null,onReg:()=>{}},e),this.wrapper=document.querySelector(this.options.wrapperSelector),this.formSendPhone=this.wrapper.querySelector(".form-send-phone"),this.formSendCode=this.wrapper.querySelector(".form-send-code"),this.formRegistration=this.wrapper.querySelector(".form-registration"),this.formSendPhone&&this.formSendCode&&this.formRegistration&&(this.validatorPhone=a.U.username(this.formSendPhone),this.validatorCode=a.U.code(this.formSendCode),this.validatorReg=(0,o.n)(this.formRegistration),this.loader=new s.a(this.wrapper),this.isReg=!1,this.resData=null,this.phone=null,this.code=null,this.timerStarted=!1,this.events())}events(){this.formSendPhone&&this.formSendPhone.addEventListener("submit",this.submitFormPhone.bind(this)),this.formSendCode&&this.formSendCode.addEventListener("submit",this.submitFormCode.bind(this)),this.formRegistration&&this.formRegistration.addEventListener("submit",this.submitRegistration.bind(this))}submitFormPhone(e){if(!this.validatorPhone.isValid||this.timerStarted)return;const t=new FormData(this.formSendPhone);this.phone=t.get("username").replace(/[+() -]/g,""),t.set("username",this.phone),this.startCountdown(e.submitter),this.getCode(t)}submitFormCode(){if(!this.validatorCode.isValid)return;const e=new FormData(this.formSendCode);e.append("phone",this.phone),this.sendCode(e)}submitRegistration(){if(!this.validatorReg.isValid)return;const e=new FormData(this.formRegistration);e.set("username",this.phone),e.delete("privacy_policy"),this.reg(e)}removeDisabled(e){e&&(e.classList.remove("_disabled"),e.elements.length&&Array.from(e.elements).forEach((e=>{e.removeAttribute("disabled")})))}startCountdown(e){if(this.timerStarted)return;const t=e.closest("form");this.timerStarted=!0,t.classList.add("_disabled");let r=120;const s=()=>{const t=Math.floor(r/60),s=r%60,i=t<10?`0${t}`:t,n=s<10?`0${s}`:s;e.querySelector("span").textContent=`${i}:${n}`};s();const i=setInterval((()=>{r-=1,s(),r<=0&&(clearInterval(i),this.timerStarted=!1,t.classList.remove("_disabled"),e.querySelector("span").textContent="Получить код")}),1e3)}async getCode(e){try{this.loader.enable();const t=await i.Ay.post("/_get_code_register_",e);if(200!==t.status)return;const{msg:r,msg_type:s}=t.data;(0,n.G)({msg:r,msg_type:s}),"success"===s&&this.removeDisabled(this.formSendCode)}catch(e){console.error("Ошибка при получение кода",e.message)}finally{this.loader.disable()}}async sendCode(e){try{this.loader.enable();const t=await i.Ay.post("/_send_code_register_",e);if(200!==t.status)return;const{msg:r,msg_type:s}=t.data;(0,n.G)({msg:r,msg_type:s}),"success"===s&&this.removeDisabled(this.formRegistration)}catch(e){console.error("Ошибка при отправки кода:",e.message)}finally{this.loader.disable()}}async reg(e){try{this.loader.enable();const t=await i.Ay.post("/_register_",e);if(200!==t.status)return;const{msg:r,msg_type:s,access_token:a}=this.resData=t.data;(0,n.G)({msg:r,msg_type:s}),"success"===s&&(this.isReg=!0,document.cookie=`token=Bearer ${a}; path=/`,this.options.onReg(),this.sendApproveEmail(a),setTimeout((()=>{this.options.redirect&&(document.location.pathname=this.options.redirect)}),200))}catch(e){console.error("Ошибка при отправки кода:",e.message)}finally{this.loader.disable()}}async sendApproveEmail(e){try{i.hU.defaults.headers.Authorization=`Bearer ${e}`,await i.hU.post("/_send_approve_email_")}catch(e){console.error(e)}}}},320:(e,t,r)=>{r.d(t,{V:()=>n,n:()=>a});var s=r(482),i=r(660);function n(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=e.querySelector('input[name="username"]');return i.default("+7 (999) 999-99-99").mask(r),t.addField(e.querySelector('input[name="username"]'),[{rule:"required",errorMessage:"Введите телефон"},{validator:e=>{const t=i.default.unmask(e,{mask:"+7 (999) 999-99-99"});return Boolean(Number(t)&&10===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="password"]'),[{rule:"required",errorMessage:"Введите пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]),t}function a(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}});return t.addField(e.querySelector('input[name="email"]'),[{rule:"required",errorMessage:"Введите почту"},{rule:"email",errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="password"]'),[{rule:"required",errorMessage:"Введите пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]).addField(e.querySelector('input[name="repassword"]'),[{rule:"required",errorMessage:"Повторите пароль"},{validator:t=>t===e.querySelector('input[name="password"]').value,errorMessage:"Пароли не совпадают"}]).addField(e.querySelector('input[name="privacy_policy"]'),[{rule:"required"}]),t}},220:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(212),i=r(194);const n=class{constructor(e,t){e&&(this.wrapper=e,this.paymentCards=null,this.cards=[],this.cardsPayment=[],this.userType="f",this.requisites=[],this.options=Object.assign({isLinkCard:!0},t),this.options.isLinkCard,this.init())}init(){this.paymentCards=this.wrapper.querySelector(".payment-cards"),this.paymentCards||(this.paymentCards=document.createElement("div"),this.paymentCards.classList.add("payment-cards"),this.wrapper.appendChild(this.paymentCards))}getNumberCard(e){if(!e||!this.cards.length)return;const[t]=this.cards.filter((t=>+t.card_id==+e));return t?t.pan:null}setCheckedInput(e=0){if(e>this.cardsPayment.length-1)return;const t=this.cardsPayment[e].querySelector('input[name="card_id"]');return t?(t.checked=!0,t):null}async render(e){try{e&&e.enable();const t=await s.hU.get("/_get_client_cards_list_");if(200!==t.status)return;const{cards:r}=t.data;return this.paymentCards.innerHTML="",r&&r.length?(r.forEach((e=>{var t;this.paymentCards.insertAdjacentHTML("beforeend",`<label class="payment-cards__card card-payment">\n                    <img src="img/icons/${function(e){if(!e)return;let t="";return t=/^4/.test(e)?"visa.png":/^5[0-5]/.test(e)?"mastercard.png":/^2([2-7]|6(3|7))/.test(e)?"mir.svg":"card.png",t}((t=e).pan)}" alt="Иконка">\n                    <span>• • ${t.pan?t.pan.slice(-4):""}</span>\n                    <input type="radio" name="card_id" class="rent-room__payment_input-radio input-radio" id="card_id-${t.card_id?t.card_id:""}" value="${t.card_id?t.card_id:""}">\n                    <label for="card_id-${t.card_id?t.card_id:""}" class="rent-room__payment_label label-radio"></label>\n                  </label>`)})),this.cardsPayment=this.paymentCards.querySelectorAll(".card-payment"),this.cards=r,this.setCheckedInput()):this.paymentCards.insertAdjacentHTML("afterbegin",'<span style="line-height: normal;">У Вас нет привязанной карты</span>'),this.options.isLinkCard&&(this.paymentCards.insertAdjacentHTML("beforeend",'<label class="payment-cards__card card-payment">\n                    <img src="img/icons/card.png" alt="Иконка">\n                    <span>Привязать карту</span>\n                    <input type="radio" name="card_id" class="rent-room__payment_input-radio input-radio input-link-card" id="card_id-9фыв" value="null">\n                    <label for="card_id-9фыв" class="rent-room__payment_label label-radio"></label>\n                  </label>'),r.length||(this.paymentCards.querySelector(".input-link-card").checked=!0)),"u"===this.userType&&(this.paymentCards.innerHTML="",this.requisites.length&&this.requisites.forEach((e=>{this.paymentCards.insertAdjacentHTML("beforeend",(0,i.O)(e))}))),r}catch(e){console.error(e)}finally{e&&e.disable()}}}},784:(e,t,r)=>{r.r(t),r.d(t,{default:()=>M});var s=r(244),i=r(325),n=r(922),a=r(508),o=r(212),l=r(1),d=r(255),u=r(482),m=r(660),c=r(528),h=r(836);const p=(new Date).getFullYear();function y(){const e=new Date;return new Date(e.getFullYear()-18,e.getMonth(),e.getDate())}var g=r(47),f=r(417),v=r(433),_=r(514);async function b(e,t){try{t.enable();const r=await o.hU.post("/_form_new_agreement_",e,{headers:{Authorization:(0,v.R)("token"),"Content-Type":"multipart/form-data"}});if(200!==r.status)return;(0,_.G)(r.data),"success"===r.data.msg_type&&(document.location.pathname="/account.html")}catch(e){console.error(e)}finally{t.disable()}}var S=r(449),q=r(220),w=r(119);const M=class{constructor(){this.rentRoom=document.querySelector(".rent-room"),this.rentRoom&&(this.urlParams=new URLSearchParams(window.location.search),this.roomIds=this.urlParams.get("ids")?JSON.parse(this.urlParams.get("ids")):[],this.roomIds.length&&(this.loader=new n.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed"}),this.authorizationTabs=new i.t("authorization-rent-room-tabs",{activeIndexTab:1}),this.authorization=new l.default({wrapperSelector:".authorization-rent-room"}),this.registration=new d.default({wrapperSelector:".authorization-rent-room"}),this.modalCheckingDetailsForm=new a.a(".modal-checking-details-form",{modalBtnClose:".btn-modal-close"}),this.modalCheckingInfoForm=new a.a(".modal-checking-info-form",{modalBtnClose:".btn-modal-close"}),this.cards=new q.A(this.rentRoom.querySelector(".form-payment-online")),this.isAuth=(0,o.T5)(),this.stepProgress=this.rentRoom.querySelectorAll(".step-progress"),this.scaleProgress=this.rentRoom.querySelector(".scale-progress"),this.steps=this.rentRoom.querySelectorAll(".rent-room-step"),this.activeIndexStep=0,this.scaleValues=[35,65,100],this.roomsSlider=new Swiper(".rooms-slider-rent-room",{spaceBetween:10,observeSlideChildren:!0,observer:!0,pagination:{el:".paging-slider-rent-rooms"},navigation:{nextEl:".btn-slider-rent-rooms-next",prevEl:".btn-slider-rent-rooms-prev"}}),this.rooms=this.rentRoom.querySelector(".rooms-rent-room"),this.formPaymentOnline=this.rentRoom.querySelector(".form-payment-online"),this.validatorPaymentOnline=function(e){if(!e)return;const t=new u.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=e.querySelectorAll('input[name="card-payment"]');return r.length&&r.forEach((e=>{t.addField(e,[{rule:"required"}])})),t.addField(e.querySelector('input[name="privacy-policy"]'),[{rule:"required"}]),t}(this.formPaymentOnline),this.formPaymentInvoice=this.rentRoom.querySelector(".form-payment-invoice"),this.validatorPaymentInvoice=function(e){if(!e)return;const t=new u.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=e.querySelector('input[name="bik"]'),s=e.querySelector('input[name="inn"]'),i=e.querySelector('input[name="kpp"]'),n=e.querySelector('input[name="bank"]'),a=e.querySelector('input[name="rs"]'),o=e.querySelector('input[name="ks"]');return t.addField(e.querySelector('input[name="fullname"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(e.querySelector('input[name="address"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(r,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>9?r.value=e.slice(0,9):r.value=e.replace(/[^0-9]/g,""),9===r.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(s,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>10?s.value=e.slice(0,10):s.value=e.replace(/[^0-9]/g,""),10===s.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(i,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>9?i.value=e.slice(0,9):i.value=e.replace(/[^0-9]/g,""),9===i.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(n,[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё\s]+$/,errorMessage:"Неверный формат"}]).addField(a,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>20?a.value=e.slice(0,20):a.value=e.replace(/[^0-9]/g,""),20===a.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(o,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>20?o.value=e.slice(0,20):o.value=e.replace(/[^0-9]/g,""),20===o.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="privacy-policy"]'),[{rule:"required"}]),t}(this.formPaymentInvoice),this.formAgreementConclusion=this.rentRoom.querySelector(".form-agreement-conclusion"),this.validatorAgreementConclusion=function(e){if(!e)return;const t=new u.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),s=e.querySelector('input[name="birthday"]'),i=e.querySelector('input[name="series"]'),n=e.querySelector('input[name="no"]'),a=e.querySelector('input[name="issue_date"]'),o=e.querySelector('input[name="subdivision"]');return m.default("9999").mask(i),m.default("999999").mask(n),m.default("999-999").mask(o),new h.A(s,{dateFormat:"yyyy-MM-dd",position:"bottom center",autoClose:!0,maxDate:y(),isMobile:r}),new h.A(a,{dateFormat:"yyyy-MM-dd",position:"bottom center",autoClose:!0,isMobile:r}),t.addField(e.querySelector('input[name="familyname"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="firstname"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="patronymic"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="birthday"]'),[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{let t=!1,r=+e.split("-")[2];return e.split("-")[1],e.split("-")[0],r<=p-18&&(t=!0),t},errorMessage:"Вам нет 18"}]).addField(e.querySelector('input[name="address"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(i,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=m.default.unmask(e,{mask:"9999"});return Boolean(Number(t)&&4===t.length)},errorMessage:"Неверный формат"}]).addField(n,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=m.default.unmask(e,{mask:"999999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(a,[{rule:"required",errorMessage:"Заполните поле"},{plugin:(0,c.A)((e=>({required:!0,format:"yyyy-MM-dd"}))),errorMessage:"Неверный формат"}]).addField(o,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=m.default.unmask(e,{mask:"999-999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="issued_by"]'),[{rule:"required",errorMessage:"Заполните поле"}]),t}(this.formAgreementConclusion),this.inputMonth=this.rentRoom.querySelector(".input-month"),this.month=this.urlParams.get("num_monthes")?JSON.parse(this.urlParams.get("num_monthes")):null,this.agreementData=null,this.user=null,this.formDataPaymentInvoice=null,this.payment=this.rentRoom.querySelector(".payment-rent-room"),this.paymentTabs=new i.t("payment-rent-room-tabs"),this.inputFile=this.rentRoom.querySelector(".input-file"),this.event=new Event("submit",{cancelable:!0}),this.resultPriceRooms=this.rentRoom.querySelectorAll(".result-price-room"),this.sumPriceCells=0,this.events(),this.init()))}events(){this.rentRoom&&this.roomIds.length&&(document.addEventListener("click",(e=>{if(e.target.closest(".tab-registration")&&(e.preventDefault(),this.authorizationTabs.switchTabs(this.authorizationTabs.tabs.querySelector(".btn-registration"))),e.target.closest(".tab-authorization")&&(e.preventDefault(),this.authorizationTabs.switchTabs(this.authorizationTabs.tabs.querySelector(".btn-authorization"))),e.target.closest(".item-month")){const t=e.target.closest(".item-month"),r=+t.getAttribute("data-month"),s=this.rentRoom.querySelector(".item-month._active");if(!r)return;const[i,n]=this.calculatePriceAndDepositByMonth(r,this.agreementData);this.inputMonth.classList.remove("just-validate-error-field"),this.inputMonth.value=r,this.month=r,s&&s.classList.remove("_active"),t&&t.classList.add("_active"),this.payment.scrollIntoView({behavior:"smooth",block:"start"}),this.changePriceSum(i,n)}if(e.target.closest(".button-send-form-payment-invoice")&&this.formDataPaymentInvoice&&async function(e,t){try{t.enable();const r=await o.hU.post("/_form_new_agreement_",e,{headers:{Authorization:(0,v.R)("token"),"Content-Type":"multipart/form-data"}});if(200!==r.status)return;return(0,_.G)(r.data),"success"!==r.data.msg_type?null:r.data}catch(e){console.error(e)}finally{t.disable()}}(this.formDataPaymentInvoice,this.loader).then((e=>{e&&(this.modalCheckingInfoForm.modal.querySelector(".btn-download-invoice")?.setAttribute("data-bill-id",e.bill_id),this.modalCheckingInfoForm.modal.querySelector(".content").innerHTML=function(e){return`<b style="align-items: center;">Счет ${e.bill_id?e.bill_id:""} сформирован и отправлен вам на почту ${e.email?e.email:""}</b>`}({...e,email:this.user.email}),this.modalCheckingInfoForm.open())})),e.target.closest(".btn-download-invoice")){const t=e.target.closest(".btn-download-invoice").getAttribute("data-bill-id");t&&(0,S.iK)(t,this.loader,"/account.html")}})),this.inputMonth&&this.inputMonth.addEventListener("input",(e=>{const t=this.rentRoom.querySelector(".item-month._active"),r=this.rentRoom.querySelector(`.item-month[data-month="${this.inputMonth.value}"]`),s=this.inputMonth.value;this.month=s,0==+s?this.inputMonth.value="":this.inputMonth.value.length>2?this.inputMonth.value=s.slice(0,2):this.inputMonth.value=s.replace(/[^0-9]/g,"");const[i,n]=this.calculatePriceAndDepositByMonth(s,this.agreementData);(1!=+s.slice(0,1)&&1===this.inputMonth.value.length||this.inputMonth.value.length>1)&&(e.target.blur(),this.payment.scrollIntoView({behavior:"smooth",block:"start"})),this.inputMonth.classList.remove("just-validate-error-field"),t&&t.classList.remove("_active"),r&&r.classList.add("_active"),this.changePriceSum(i,n)})),this.inputFile&&this.inputFile.addEventListener("change",(e=>{e.target.files.length?(e.target.parentElement.classList.remove("_error"),this.inputFile.parentElement.querySelector("b").innerHTML=e.target.files[0].name):(e.target.parentElement.classList.add("_error"),this.inputFile.parentElement.querySelector("b").innerHTML="")})),this.formPaymentOnline&&this.formPaymentOnline.addEventListener("submit",this.submitPaymentOnline.bind(this)),this.formPaymentInvoice&&this.formPaymentInvoice.addEventListener("submit",this.submitPaymentInvoice.bind(this)),this.formAgreementConclusion&&this.formAgreementConclusion.addEventListener("submit",this.submitAgreementConclusion.bind(this)),this.authorization.options.onAuth=()=>{ym(97074608,"reachGoal","auth"),this.swapStep(this.activeIndexStep=1),this.getUser(),o.hU.defaults.headers.Authorization=(0,v.R)("token")},this.registration.options.onReg=()=>{ym(97074608,"reachGoal","register"),this.swapStep(this.activeIndexStep=1),this.getUser(),o.hU.defaults.headers.Authorization=(0,v.R)("token")})}init(){this.rentRoom&&this.roomIds.length&&(this.isAuth&&(this.activeIndexStep=this.urlParams.get("step")?+this.urlParams.get("step"):1,this.swapStep(this.activeIndexStep),this.getUser(),2==this.activeIndexStep&&ym(97074608,"reachGoal","order")),this.roomIds.length&&this.renderRooms((0,f.D)({room_ids:JSON.stringify(this.roomIds)})))}swapStep(e){if(!this.steps.length||!this.stepProgress.length)return;const t=this.rentRoom.querySelector(".step-progress._active"),r=this.rentRoom.querySelector(".rent-room-step._step-active");t&&t.classList.remove("_active"),this.stepProgress[e].classList.add("_active"),r&&r.classList.remove("_step-active"),this.steps[e].classList.add("_step-active"),this.scaleProgress&&(this.scaleProgress.style.width=this.scaleValues[e]+"%"),1==e?(this.cards.render(this.loader),this.payment.classList.remove("_none")):this.payment.classList.add("_none")}submitPaymentOnline(e){if(!this.month)return this.inputMonth.classList.add("just-validate-error-field"),void this.scrollToErrInput(this.inputMonth);if(this.inputMonth.classList.remove("just-validate-error-field"),!this.validatorPaymentOnline.isValid)return;const t=new FormData(e.target);t.delete("card-number"),t.delete("exp-date"),t.delete("cvc"),t.delete("privacy-policy"),t.set("room_ids",JSON.stringify(this.roomIds)),t.set("user_type","f"),t.set("num_monthes",this.month),t.set("autopay",t.get("auto-payments")?1:0),t.set("return_url",location.href+`&step=2&num_monthes=${this.month}`),t.delete("auto-payments"),(0,S.KD)(t,this.loader)}submitPaymentInvoice(e){if(e.preventDefault(),this.validatorPaymentInvoice.isValid){if(!this.month)return this.inputMonth.classList.add("just-validate-error-field"),void this.scrollToErrInput(this.inputMonth);this.inputMonth.classList.remove("just-validate-error-field");const t=new FormData(e.target);let r={};t.set("room_ids",JSON.stringify(this.roomIds)),t.set("num_monthes",this.month),t.set("user_type","u"),t.set("rent_or_test","rent"),t.delete("privacy-policy"),Array.from(t).forEach((e=>r[e[0]]=e[1])),r.price=this.sumPriceDiscCells?this.sumPriceDiscCells:this.sumPriceCells,r.email=this.user.email,r.fio=`${this.user.familyname} ${this.user.firstname} ${this.user.patronymic}`,this.formDataPaymentInvoice=t,this.modalCheckingDetailsForm.modal.querySelector(".content").innerHTML=function(e){return`\n  <b>Проверка и подтверждение выписки счета</b>\n  <span>Организация: "${e.fullname?e.fullname:""}"</span>\n  <span>ИНН: ${e.inn?e.inn:""}</span>\n  <span>Сумма: ${e.price?(0,g.F)(e.price):""}</span>\n  <span>Email: ${e.email?e.email:""}</span>\n  <span>Адрес: ${e.address?e.address:""}</span>`}(r),this.modalCheckingDetailsForm.open()}else this.scrollToErrInput(this.formPaymentInvoice.querySelector(".just-validate-error-field"))}submitAgreementConclusion(e){if(e.preventDefault(),!this.user.approved){if(!this.inputFile.files.length)return void this.inputFile.parentElement.classList.add("_error");this.inputFile.parentElement.classList.remove("_error")}if(this.validatorAgreementConclusion.isValid){const e=new FormData(this.formAgreementConclusion);e.set("room_ids",JSON.stringify(this.roomIds)),e.set("user_type","f"),e.set("num_monthes",this.month),e.set("rent_or_test","rent"),b(e,this.loader)}else this.scrollToErrInput(this.formAgreementConclusion.querySelector(".input.just-validate-error-field"))}async renderRooms(e){try{this.loader.enable();const t=await o.Ay.get(`/_form_new_agreement_get_${e}`);if(200!==t.status)return;this.agreementData=t.data;const{rooms:r,amount_1m:s,deposit_1m:i}=t.data,n=this.rentRoom.querySelector(".bottom-rooms-slider-rent-room"),a=this.rentRoom.querySelectorAll("[data-amount]");if(!r||!r?.length)return;this.rooms.innerHTML="",this.sumPriceCells=s,r.forEach((e=>{var t;e.volume>1.5&&(e.price=(0,w.l)(e.price)),this.rooms.insertAdjacentHTML("beforeend",`\n  <div class="rent-room__room swiper-slide">\n    <div class="rent-room__room_img">\n      <img src="img/rooms.jpg" alt="Картинка">\n    </div>\n    <div class="rent-room__room_content">\n      <div class="rent-room__room_top">\n        <h4 class="rent-room__room_title">${(t=e).room_id?"Кладовка "+t.room_id:""}</h4>\n        <span class="rent-room__room_price">${t.price?"от "+(0,g.F)(t.price)+"/мес.":""}</span>\n      </div>\n    <div class="rent-room__room_features"><span>Электромеханический замок</span></div>\n      <ul class="rent-room__room_characteristic">\n        <li>\n          <span>Площадь</span>\n          <b>${t.area?t.area+" м<sup>2</sup>":""}</b>\n        </li>\n        <li>\n          <span>Объём</span>\n          <b>${t.volume?t.volume+" м<sup>3</sup>":""}</b>\n        </li>\n        <li>\n          <span>Размер кладовки (ДхШхВ)</span>\n          <b>${t.dimensions?t.dimensions:""}</b>\n        </li>\n      </ul>\n    </div>\n  </div>`)})),a.length&&a.forEach((e=>{const r=e.closest(".item-month"),s=t.data[e.getAttribute("data-amount")];r.setAttribute("data-price",s),e.textContent=`от ${(0,g.F)(s)}`})),n&&1===r.length&&n.classList.add("_none"),this.changePriceSum(this.sumPriceCells,i)}catch(e){console.error(e)}finally{this.loader.disable()}}async getUser(){try{this.loader.enable();const e=await o.Ay.get("/_profile_",{headers:{Authorization:(0,v.R)("token")}});if(200!==e.status)return;const t=this.rentRoom.querySelectorAll(".input-agreement-conclusion"),r=this.rentRoom.querySelectorAll(".rent-room__payment_input"),{user:s}=e.data;if(this.user=s,t.length&&t.forEach((e=>{e.value=s[e.name]?s[e.name]:""})),r.length&&r.forEach((e=>{e.value=s[e.name]?s[e.name]:""})),"f"===s.user_type?(document.querySelector(".rent-room__payment_tabs").classList.add("_none"),this.paymentTabs.switchTabs(document.querySelector('[data-tabs-btn="payment-rent-room-tabs-0"]'))):"u"===s.user_type?(document.querySelector(".rent-room__payment_tabs").classList.add("_none"),this.paymentTabs.switchTabs(document.querySelector('[data-tabs-btn="payment-rent-room-tabs-1"]'))):document.querySelector(".rent-room__payment_tabs").classList.remove("_none"),2==this.activeIndexStep&&this.user.approved){const e=new FormData;e.set("room_ids",JSON.stringify(this.roomIds)),e.set("user_type","f"),e.set("num_monthes",this.month),b(e,this.loader)}}catch(e){console.error(e)}finally{this.loader.disable()}}scrollToErrInput(e){e&&("privacy-policy"===e.name?this.formPaymentInvoice.querySelector(".privacy-policy").scrollIntoView({behavior:"smooth",block:"center"}):e.scrollIntoView({behavior:"smooth",block:"center"}))}calculatePriceAndDepositByMonth(e,t){let r=0,s=0;return e<6?(r=t.amount_1m,s=t.deposit_1m):e>=6&&e<=10?(r=t.amount_6m,s=t.deposit_6m):e>10&&(r=t.amount_11m,s=t.deposit_11m),[r,s]}changePriceSum(e,t){this.resultPriceRooms.length&&this.resultPriceRooms.forEach(((r,i)=>{1===i?(r.style.cssText="display: flex; align-items: center; gap: 6px;",r.innerHTML=`<span>${(0,g.F)(+e+ +t)}</span><svg class='icon icon-info' style="width: 30px; height: 40px;">\n  <use xlink:href='img/svg/sprite.svg#info'></use>\n</svg>`,(0,s.Ay)(".icon-info",{content:`<div style="display: grid; grid-template-columns: auto 1fr; gap: 6px; background-color: #f5f5f5; padding: 5px; border: 1px solid #000; border-radius: 4px; box-shadow: 0 2px 4px 2px rgba(0,0,0,0.25); font-size: 12px;">\n          <b>${(0,g.F)(+e)}</b><span>арендный платеж за первый месяц</span>\n          <b>${(0,g.F)(+t)}</b><span>депозит (вернется после окончания аренды)</span></p>\n          </div>`,allowHTML:!0})):r.textContent=(0,g.F)(+e)+"/мес"}))}}}}]);