"use strict";(self.webpackChunkgulp2024=self.webpackChunkgulp2024||[]).push([[255],{255:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var s=r(922),o=r(212),i=r(514),a=r(304),n=r(320);const d=class{constructor(e){this.options=Object.assign({wrapperSelector:".content-registration",redirect:null,onReg:()=>{}},e),this.wrapper=document.querySelector(this.options.wrapperSelector),this.formSendPhone=this.wrapper.querySelector(".form-send-phone"),this.formSendCode=this.wrapper.querySelector(".form-send-code"),this.formRegistration=this.wrapper.querySelector(".form-registration"),this.formSendPhone&&this.formSendCode&&this.formRegistration&&(this.validatorPhone=a.U.username(this.formSendPhone),this.validatorCode=a.U.code(this.formSendCode),this.validatorReg=(0,n.n)(this.formRegistration),this.loader=new s.a(this.wrapper),this.isReg=!1,this.resData=null,this.phone=null,this.code=null,this.timerStarted=!1,this.events())}events(){this.formSendPhone&&this.formSendPhone.addEventListener("submit",this.submitFormPhone.bind(this)),this.formSendCode&&this.formSendCode.addEventListener("submit",this.submitFormCode.bind(this)),this.formRegistration&&this.formRegistration.addEventListener("submit",this.submitRegistration.bind(this))}submitFormPhone(e){if(!this.validatorPhone.isValid||this.timerStarted)return;const t=new FormData(this.formSendPhone);this.phone=t.get("username").replace(/[+() -]/g,""),t.set("username",this.phone),this.getCode(t,e)}submitFormCode(){if(!this.validatorCode.isValid)return;const e=new FormData(this.formSendCode);e.append("phone",this.phone),this.sendCode(e)}submitRegistration(){if(!this.validatorReg.isValid)return;const e=new FormData(this.formRegistration);e.set("username",this.phone),e.delete("privacy_policy"),this.reg(e)}removeDisabled(e){e&&(e.classList.remove("_disabled"),e.elements.length&&Array.from(e.elements).forEach((e=>{e.removeAttribute("disabled")})))}startCountdown(e){if(this.timerStarted)return;const t=e.closest("form");this.timerStarted=!0,t.classList.add("_disabled");let r=120;const s=()=>{const t=Math.floor(r/60),s=r%60,o=t<10?`0${t}`:t,i=s<10?`0${s}`:s;e.querySelector("span").textContent=`${o}:${i}`};s();const o=setInterval((()=>{r-=1,s(),r<=0&&(clearInterval(o),this.timerStarted=!1,t.classList.remove("_disabled"),e.querySelector("span").textContent="Получить код")}),1e3)}async getCode(e,t){try{this.loader.enable();const r=await o.Ay.post("/_get_code_register_",e);if(200!==r.status)return;const{msg:s,msg_type:a}=r.data;(0,i.G)({msg:s,msg_type:a}),"success"===a&&(this.removeDisabled(this.formSendCode),this.startCountdown(t.submitter))}catch(e){console.error("Ошибка при получение кода",e.message)}finally{this.loader.disable()}}async sendCode(e){try{this.loader.enable();const t=await o.Ay.post("/_send_code_register_",e);if(200!==t.status)return;const{msg:r,msg_type:s}=t.data;(0,i.G)({msg:r,msg_type:s}),"success"===s&&this.removeDisabled(this.formRegistration)}catch(e){console.error("Ошибка при отправки кода:",e.message)}finally{this.loader.disable()}}async reg(e){try{this.loader.enable();const t=await o.Ay.post("/_register_",e);if(200!==t.status)return;const{msg:r,msg_type:s,access_token:a,expiration_time:n}=this.resData=t.data;(0,i.G)({msg:r,msg_type:s}),"success"===s&&(this.isReg=!0,document.cookie=`token=Bearer ${a}; max-age=${n}; path=/`,this.options.onReg(),this.sendApproveEmail(a),setTimeout((()=>{this.options.redirect&&(document.location.pathname=this.options.redirect)}),200))}catch(e){console.error("Ошибка при отправки кода:",e.message)}finally{this.loader.disable()}}async sendApproveEmail(e){try{o.hU.defaults.headers.Authorization=`Bearer ${e}`,await o.hU.post("/_send_approve_email_")}catch(e){console.error(e)}}}},320:(e,t,r)=>{r.d(t,{V:()=>i,n:()=>a});var s=r(482),o=r(660);function i(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=e.querySelector('input[name="username"]');return o.default("+7 (999) 999-99-99").mask(r),t.addField(e.querySelector('input[name="username"]'),[{rule:"required",errorMessage:"Введите телефон"},{validator:e=>{const t=o.default.unmask(e,{mask:"+7 (999) 999-99-99"});return Boolean(Number(t)&&10===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="password"]'),[{rule:"required",errorMessage:"Введите пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]),t}function a(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}});return t.addField(e.querySelector('input[name="email"]'),[{rule:"required",errorMessage:"Введите почту"},{rule:"email",errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="password"]'),[{rule:"required",errorMessage:"Введите пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]).addField(e.querySelector('input[name="repassword"]'),[{rule:"required",errorMessage:"Повторите пароль"},{validator:t=>t===e.querySelector('input[name="password"]').value,errorMessage:"Пароли не совпадают"}]).addField(e.querySelector('input[name="privacy_policy"]'),[{rule:"required"}]),t}}}]);