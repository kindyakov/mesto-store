"use strict";(self.webpackChunkgulp2024=self.webpackChunkgulp2024||[]).push([[901],{901:(e,t,o)=>{o.r(t),o.d(t,{default:()=>j});var s=o(325),r=o(922),a=o(212),n=o(47),i=o(508),c=o(514);const l=class{constructor({loader:e}){this.modalSelectWarehouse=new i.a(".modal-select-warehouse",{modalBtnClose:".btn-modal-close"}),this.modalSelectRoom=new i.a(".modal-select-room-access",{modalBtnClose:".btn-modal-close"}),this.modalConfirmOpenRoom=new i.a(".modal-confirm-open-room",{modalBtnClose:".btn-modal-close"}),this.loader=e,this.loaderModalWarehouse=new r.a(this.modalSelectWarehouse.modal.querySelector(".modal__body")),this.warehousesModal=this.modalSelectWarehouse.modal.querySelector(".modal-select-warehouse__wrapper"),this.roomsModal=this.modalSelectRoom.modal.querySelector(".modal-select-room-access__rooms"),this.warehouseIds=[],this.warehouseId=null,this.roomId=null,this.clientData=null,this.modalConfirmOpenRoom.modal.querySelector(".btn-yes").addEventListener("click",(e=>{this.roomId&&this.sendRequest(this.roomId)}))}open(e){Boolean(e)&&(this.clientData=e,this.warehouseIds=[...new Set([...e.rooms.map((e=>e.warehouse_id)),...e.test_rooms.map((e=>e.warehouse_id))])],this.warehouseIds.length>1?this.renderWarehouses():([this.warehouseId]=this.warehouseIds,this.renderRooms(this.warehouseId)))}handlerClickToWarehouse(){const e=this.modalSelectWarehouse.modal.querySelector(".modal-select-warehouse__warehouse");e.length&&e.forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-warehouse-id");t&&(this.warehouseId=+t,this.renderRooms(+t))}))}))}handlerClickToRoomBtn(){const e=this.modalSelectRoom.modal.querySelectorAll(".btn-open-room-modal");e.length&&e.forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-room-id");t&&(this.roomId=+t,this.renderModalConfirm())}))}))}async renderWarehouses(){try{this.loaderModalWarehouse.enable();const e=await a.Ay.get("/_get_warehouses_info_");if(200!==e.status)return;const{warehouses:t}=e.data;this.warehousesModal.innerHTML="",t.length&&t.forEach((e=>{var t;this.warehousesModal.insertAdjacentHTML("beforeend",`\n  <div class="modal-select-warehouse__warehouse btn-modal-close" data-warehouse-id="${(t=e).warehouse_id?t.warehouse_id:""}">\n            <div class="modal-select-warehouse__warehouse_img">\n              <img src="img/warehouse-2.png" alt="Картинка">\n            </div>\n            <div class="modal-select-warehouse__warehouse_content">\n              <h6>${t.warehouse_name?t.warehouse_name:""}</h6>\n              <address>\n                <svg class='icon icon-placemark'>\n                  <use xlink:href='img/svg/sprite.svg#placemark'></use>\n                </svg>\n                <span>${t.warehouse_address?t.warehouse_address:""}</span>\n              </address>\n            </div>\n          </div>`)})),this.handlerClickToWarehouse(),this.modalSelectWarehouse.open()}catch(e){console.log(e)}finally{this.loaderModalWarehouse.disable()}}renderRooms(e){if(!e)return;const t=[...this.clientData.rooms,...this.clientData.test_rooms].filter((t=>+t.warehouse_id==+e));t.length&&(this.roomsModal.innerHTML="",t.length>1?(t.length&&t.forEach((e=>{var t;this.roomsModal.insertAdjacentHTML("beforeend",`<div class="modal-select-room-access__room" data-room-id="${(t=e).room_id?t.room_id:""}">\n            <h6>${t.room_id?"Кладовка "+t.room_id:""}</h6>\n            <div>\n              <span>${t.volume?t.volume+" м³":""}</span>\n              <span>${t.floor?t.floor+" ярус":""}</span>\n            </div>\n            <button class="button btn-open-room-modal btn-modal-close" data-room-id="${t.room_id?t.room_id:""}"><span>Открыть</span></button>\n          </div>`)})),this.handlerClickToRoomBtn(),this.modalSelectRoom.open()):(this.roomId=t[0].room_id,this.renderModalConfirm()))}renderModalConfirm(){this.modalConfirmOpenRoom.modal.querySelector(".modal-confirm-open-room__content p").innerHTML=`\n    Вы уверены, что хотите открыть кладовку ${this.roomId} на складе ${this.warehouseId}?`,this.modalConfirmOpenRoom.open()}async sendRequest(e){try{this.loader.enable();const t=await a.hU.post(`/unlock/${e}`);if(200!==t.status)return;(0,c.G)(t.data)}catch(e){console.error(e)}finally{this.loader.disable()}}},d=class{constructor({loader:e}){this.modalConfirmOpenBarrier=new i.a(".modal-confirm-open-barrier",{modalBtnClose:".btn-modal-close"}),this.loader=e,this.events()}events(){this.modalConfirmOpenBarrier.modal&&this.modalConfirmOpenBarrier.modal.addEventListener("click",(e=>{e.target.closest(".btn-yes")&&this.openBarrier()}))}renderModalConfirm(){this.modalConfirmOpenBarrier.modal.querySelector(".modal-confirm-open-barrier__content p").innerHTML="\n    Вы уверены, что хотите открыть шлагбаум на складе 1?",this.modalConfirmOpenBarrier.open()}async openBarrier(){try{this.loader.enable();const e=await a.hU.get("/_open_barrier_");if(200!==e.status)return;(0,c.G)(e.data)}catch(e){console.error(e)}finally{this.loader.disable()}}},m=class{constructor({loader:e}){this.modalConfirmOpenGates=new i.a(".modal-confirm-open-gates",{modalBtnClose:".btn-modal-close"}),this.loader=e}renderModalConfirm(){this.modalConfirmOpenGates.modal.querySelector(".modal-confirm-open-barrier__content p").innerHTML="\n    Вы уверены, что хотите открыть ворота на складе 1?",this.modalConfirmOpenGates.open()}},h=class{constructor({loader:e}){this.modalConfirmOpenDoor=new i.a(".modal-confirm-open-door",{modalBtnClose:".btn-modal-close"}),this.loader=e,this.events()}events(){this.modalConfirmOpenDoor.modal&&this.modalConfirmOpenDoor.modal.addEventListener("click",(e=>{e.target.closest(".btn-yes")&&this.unlock()}))}renderModalConfirm(){this.modalConfirmOpenDoor.modal.querySelector(".modal-confirm-open-barrier__content p").innerHTML="\n    Вы уверены, что хотите открыть дверь на складе 1?",this.modalConfirmOpenDoor.open()}async unlock(){try{this.loader.enable();const e=await a.hU.post("unlock/0");if(200!==e.status)return;(0,c.G)(e.data)}catch(e){console.error(e)}finally{this.loader.disable()}}},u=class{constructor(){this.assetsStorage=document.querySelector(".account-assets-storage"),this.assetsStorage&&(this.assetsStorageRooms=document.querySelector(".assets-storage__rooms"),this.loader=new r.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed",id:"assets-storage-loader"}),this.storeroomsSliderWrapper=document.querySelector(".account-storerooms-slider-wrapper"),this.storeroomsSlider=new Swiper(".account-storerooms-slider",{spaceBetween:10,observeSlideChildren:!0,observer:!0,breakpoints:{320:{slidesPerView:1},480:{slidesPerView:1.5},992:{slidesPerView:2},1200:{slidesPerView:2.5}},pagination:{el:".account-storerooms-rooms__paging"},navigation:{nextEl:".account-storerooms-rooms__slider-button.btn-next",prevEl:".account-storerooms-rooms__slider-button.btn-prev"}}),this.clientData=null,this.openRoom=new l({loader:this.loader}),this.openBarrier=new d({loader:this.loader}),this.openGates=new m({loader:this.loader}),this.openDoor=new h({loader:this.loader}),this.events())}events(){this.assetsStorage.addEventListener("click",(e=>{e.target.closest(".btn-open-room")&&this.openRoom.open(this.clientData),e.target.closest(".btn-open-barrier")&&this.openBarrier.modalConfirmOpenBarrier.open(),e.target.closest(".btn-open-gates")&&this.openGates.modalConfirmOpenGates.open(),e.target.closest(".btn-open-door")&&this.openDoor.modalConfirmOpenDoor.open()})),this.storeroomsSliderWrapper.addEventListener("click",(e=>{if(e.target.closest(".btn-open-room-modal")){const t=e.target.closest(".btn-open-room-modal").getAttribute("data-room-id");t&&this.openRoom.sendRequest(t)}}))}render({accountTabs:e,clientTotalData:t}){if(!t)return;const{rooms:o}=t;this.clientData=t,this.storeroomsSliderWrapper.innerHTML="",o.length&&o.forEach((e=>{var t;this.storeroomsSliderWrapper.insertAdjacentHTML("beforeend",`\n  <div class="agreement2__container-bottom__row__block room-bottom account-storerooms-rooms__slider-slide swiper-slide" data-room-id="${(t=e).room_id?t.room_id:""}">\n                <div class="agreement2__container-bottom__row__block__row-1 account-storerooms-rooms__slider-slide_top">\n                  <h4>${t.room_id?"Кладовка "+t.room_id:""}</h4>\n                  <p>\n                    <span>${t.volume?t.volume+" м³":""}</span>\n                    <span>${t.floor?t.floor:""} этаж</span>\n                  </p>\n                </div>\n                <div class="agreement2__container-bottom__row__block__row-2 account-storerooms-rooms__slider-slide_content">\n                  <span>${t.dimensions?t.dimensions:""}</span>\n                  <b>${t.price_1m?(0,n.F)(t.price):""}</b>\n                </div>\n                <div class="agreement2__container-bottom__row__block__row-3 container-bottom-grid account-storerooms-rooms__slider-slide_bottom">\n                ${1===t.rented?`<button class="btn-complete-lease button" data-room-id="${t.room_id?t.room_id:""}"><span>Завершить аренду</span></button>`:""}\n                ${.75===t.rented?`<button class="button btn-open-room-modal btn-modal-close" data-room-id="${t.room_id?t.room_id:""}"><span>Открыть</span></button>`:`<button class="btn-payment btn-modal-payments-room-open button" data-room-id="${t.room_id?t.room_id:""}" data-agreement-id="${t.agrid?t.agrid:""}" data-months="${t.rent_period?t.rent_period:""}"><span>Оплатить</span></button>`}\n                </div>\n              </div>`)}))}};var p=o(244),_=o(411),g=o(543),y=o(417);function b(e){if(!e)return;const t=e.split("-");return`${t[2]}-${t[1]}-${t[0]}`}function f(e,t=""){return`\n  <div class="agreement2__row__right-col__product account-storerooms__room room-account-storerooms room-accordion _my-accordion ${t}" data-room-id="${e.room_id&&e.room_id}">\n    <div class="account-storerooms__room_control room-accordion-control _my-accordion-control">\n      <h2 class="title-product">${e.room_id?"Кладовка "+e.room_id:""}</h2>\n      <p>${e.volume&&"<span>"+e.volume+" м³</span>"}${e.floor&&"<span>"+e.floor+" ярус</span>"}</p>\n      <b>${e.price?(0,n.F)(e.price):""}</b>\n      <svg class='icon icon-arrow-left'>\n        <use xlink:href='img/svg/sprite.svg#arrow-left'></use>\n      </svg>\n    </div>  \n    <div class="container-attributes account-storerooms__room_content room-accordion-content _my-accordion-content">\n      <div class="row">\n        <p class="title-attribute">Площадь</p>\n        <p class="value-attribute">${e.area?e.area+" м²":""}</p>\n      </div>\n      <div class="row">\n        <p class="title-attribute">Объём</p>\n        <p class="value-attribute">${e.volume?e.volume+" м³":""}</p>\n      </div>\n      <div class="row">\n        <p class="title-attribute">Размер кладовки (ДхШхВ)</p>\n        <p class="value-attribute">${e.dimensions?e.dimensions:""}</p>\n      </div>\n      <button class="btn-payment btn-modal-payments-room-open button-2" data-room-id="${e.room_id?e.room_id:""}" data-agreement-id="${e.agrid?e.agrid:""}"><span>Оплатить</span></button>\n    </div>\n  </div>`}const v=async()=>{try{const e=await a.hU.get("/_get_client_total_for_client_");return 200==e.status?e.data:null}catch(e){console.error("Ошибка при получение данных о пользователе:",e)}},w=async(e="")=>{try{const t=await a.Ay.get(`/_update_floor_for_client_${e}`);return 200==t.status?t.data:null}catch(e){console.error("Ошибка при получение данных о договорах:",e)}};var S=o(776);const q=class{constructor(){this.stroke="#004d56",this.strokeWidth=2,this.roadCenter=8.67245}drawing(e){e?.length&&e.forEach((e=>{let t=e.querySelector("rect"),o=+t.getAttribute("x"),s=+t.getAttribute("y"),r=+t.getAttribute("height"),a=+t.getAttribute("width");this.renderingPath(e,{rectX:o,rectY:s,rectW:a,rectH:r})}))}renderingPath(e,{rectX:t,rectY:o,rectW:s,rectH:r}){if(e.classList.contains("_path"))return;e.classList.add("_path");const a=e.closest(".scheme"),n=a.querySelector(".entrance"),i=(e.closest(".sector").getAttribute("data-sector"),e.closest(".group").getAttribute("data-type-location")),c=e.getAttribute("data-type-location");let l=+n.getAttribute("x"),d=+n.getAttribute("y");const m=this.createPath(e),h=this.getPathD(i,c,{entranceX:l,entranceY:d,entranceW:41,rectX:t,rectY:o,rectW:s,rectH:r});m.setAttributeNS(null,"d",h),(0,S.A)({targets:m,strokeDashoffset:[S.A.setDashoffset,0],easing:"easeInOutSine",duration:700}),a.appendChild(m)}getPathD(e,t,{entranceX:o,entranceY:s,entranceW:r,rectX:a,rectY:n,rectW:i,rectH:c}){switch(e){case"up":return`M ${o+r} ${s} L ${o+r} ${n-this.roadCenter} L ${a+i/2} ${n-this.roadCenter} L ${a+i/2} ${n}`;case"bottom":return`M ${o+r} ${s} L ${o+r} ${n+c+this.roadCenter} L ${a+i/2} ${n+c+this.roadCenter} L ${a+i/2} ${n+c}`;case"left":return`M ${o+r} ${s} L ${o+r} -${this.roadCenter} L ${a-this.roadCenter} -${this.roadCenter} L ${a-this.roadCenter} ${n+c/2} L ${a} ${n+c/2}`;case"right":if("side-right"==t)return`M ${o+r} ${s} L ${o+r} ${n+c/2} L ${a+i} ${n+c/2}`;if("side-left"==t)return`M ${o+r} ${s} L ${o+r} -${this.roadCenter} L ${a+i+this.roadCenter} -${this.roadCenter} L ${a+i+this.roadCenter} ${n+c/2} L ${a+i} ${n+c/2}`}}createPath(e){const t=e.getAttribute("data-cell-num");let o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttributeNS(null,"stroke",this.stroke),o.setAttributeNS(null,"stroke-width",this.strokeWidth),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"data-cell-num",t),o}deletePath(e){const t=e.getAttribute("data-cell-num"),o=e.closest(".scheme").querySelectorAll(`path[data-cell-num="${t}"]`);e.classList.remove("_path"),o.length&&(0,S.A)({targets:o,opacity:[1,0],duration:300,easing:"linear",complete:()=>{o.forEach((e=>e.remove()))}})}clear(e){const t=e.querySelectorAll("path"),o=e.querySelectorAll(".warehouse__svg-cell");t.length&&t.forEach((e=>e.remove())),o.length&&o.forEach((e=>e.classList.remove("_path")))}};function L(e,t=1){let o=!1;if(!e.length)return o;for(const s of e)if(s.rented===t){o=!0;break}return o}var M=o(14);function D(e){return 2===e?"my":0===e?"free":"disabled"}const T=class{constructor(){this.account=document.querySelector(".account"),this.loader=new r.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed",id:"store-rooms-loader"}),this.modalConfirmReplaceRoom=new i.a(".modal-confirm-replace-room",{modalBtnClose:".btn-modal-close"}),this.modalSelectRoom=new i.a(".modal-select-room",{modalBtnClose:".btn-modal-close"}),this.modalConfirmCancelAutopayments=new i.u(".modal-confirm-cancel-autopayments",{modalBtnActive:".btn-cancel-autopayments",modalBtnClose:".btn-modal-close"}),this.accordionAgreement=new _.n(".account-storerooms",{accordSelector:".agreement-accordion",btnSelector:".agreement-accordion-control",contentSelector:".agreement-accordion-content"}),this.accordionRoom=new _.n(".account-storerooms",{accordSelector:".room-accordion",btnSelector:".room-accordion-control",contentSelector:".room-accordion-content"}),this.paymentTabs=new s.t("account-tabs",{btnSelector:".tabs-btn-payment",contentSelector:".tabs-content-payment-cards",lotOfTabs:".agreement-account-storerooms"}),this.schemeTabs=new s.t("account-schemes-tabs",{btnSelector:".tabs-btn-schemes",contentSelector:".tabs-content-schemes"}),this.routeScheme=new q,this.schemeOne=this.account.querySelector(".scheme-1"),this.schemeTwo=this.account.querySelector(".scheme-2"),this.schemeActive=this.schemeOne,this.targetFloor=1,this.agrId=null,this.oldRoomId=null,this.newRoomId=null,this.clientData=null,this.warehouses=null,this.isMonth=!1,this.isMobile=!1,this.isReplace=!1,this.storerooms=this.account.querySelector(".account-storerooms"),this.agreements=this.account.querySelector(".agreements-account-storerooms"),this.storeroomsSliderWrapper=this.account.querySelector(".account-storerooms-slider-wrapper"),this.storeroomsSchemeRooms=this.account.querySelector(".account-storerooms-scheme__rooms"),this.storeroomsTitleAgreement=this.account.querySelector(".account-storerooms-title-agreement"),this.events()}events(){this.storeroomsSliderWrapper&&(this.account.addEventListener("click",(e=>{if(e.target.closest(".btn-download-agreement")){const t=e.target.closest(".btn-download-agreement").getAttribute("data-room-id");t&&this.downloadAgr(t)}})),window.addEventListener("resize",(e=>{Array.from(this.storeroomsSchemeRooms.querySelectorAll(".scheme-room")),window.innerWidth>768?this.isMobile=!1:this.isMobile=!0})),document.addEventListener("click",(e=>{if(e.target.closest(".warehouse__svg-cell")){e.preventDefault();const t=e.target.closest(".warehouse__svg-cell"),o=t.getAttribute("data-room-id");t.classList.contains("free")?o&&this.handlerClickToCellFree(o,t):t.classList.contains("my")&&o&&this.handlerClickToCellMy(o,t);const s=Array.from(this.storeroomsSchemeRooms.querySelectorAll(".scheme-room"));if(s.length){let e=0;e=this.isMobile?s.reduce(((e,t)=>e+t.offsetHeight),10):Math.max(...s.map((e=>e.offsetHeight)));const t=this.storeroomsSchemeRooms.getBoundingClientRect().top+document.documentElement.scrollTop-20;window.scrollTo({top:t,left:0,behavior:"smooth"}),this.storeroomsSchemeRooms.style.maxHeight=`${e}px`}else this.isMobile?this.storeroomsSchemeRooms.style.height="325px":this.storeroomsSchemeRooms.style.height="106px",this.storeroomsSchemeRooms.style.maxHeight="0px",setTimeout((()=>{this.storeroomsSchemeRooms.style.height="auto"}),400)}if(e.target.closest(".btn-replace-room")){const t=e.target.closest(".btn-replace-room").getAttribute("data-room-id");this.newRoomId=+t,this.handlerClickToBtnReplaceRoom(t)}if(e.target.closest(".btn-modal-replace-room")){const t=e.target.closest(".btn-modal-replace-room").getAttribute("data-agreement-id");this.rentNewRoom({agrId:t})}if(e.target.closest(".btn-replace-room-modal")){const t=e.target.closest(".btn-replace-room-modal").getAttribute("data-room-id");t&&(this.oldRoomId=t,this.handlerClickToBtnReplaceRoom(this.newRoomId))}})),this.schemeTabs.options.onChange=(e,t,o,s)=>{o.classList.contains("content-schemes-one")?(this.schemeActive=this.schemeOne,this.targetFloor=1):o.classList.contains("content-schemes-two")&&(this.schemeActive=this.schemeTwo,this.targetFloor=2)},this.accordionAgreement.options.onOpen=(e,t)=>{const o=e.getAttribute("data-agreement-id");o&&this.renderRooms(o)},this.accordionAgreement.options.onClose=()=>{this.storeroomsTitleAgreement.innerHTML="",this.storeroomsSchemeRooms.style.maxHeight="0px",setTimeout((()=>{this.storeroomsSchemeRooms.innerHTML=""}),400),this.oldRoomId=null,this.newRoomId=null,this.agrId=null,this.renderScheme(this.clientData.rooms,this.warehouses[0].rooms,this.schemeOne),this.renderScheme(this.clientData.rooms,this.warehouses[1].rooms,this.schemeTwo),this.routeScheme.clear(this.schemeActive)},this.modalConfirmReplaceRoom.options.onClose=e=>{e.target.closest(".btn-modal-replace-room")||(this.oldRoomId=null,this.newRoomId=null)},this.accordionRoom.options.onInit=()=>{this.accordionRoom.accords.length&&this.accordionRoom.accords.forEach((e=>{e.closest(".agreement-accordion")||(e.querySelector(".icon-arrow-left").remove(),e.querySelector(".room-accordion-control").style.cursor="auto",e.classList.add("_not-close"),this.accordionRoom.open(e,e.querySelector(".room-accordion-content")))}))},this.modalConfirmCancelAutopayments.buttonAction=e=>{if(e){const e=new FormData;e.append("agrid",this.agrId),this.cancelRecurrentPayments(e)}})}renderScheme(e,t,o){o.querySelectorAll(".warehouse__svg-cell").forEach((e=>{e.classList.remove("my","free","busy","disabled","_selected")})),t.length&&t.forEach(((e,t)=>{const s=o.querySelector(`.warehouse__svg-cell[data-cell-num="${e.room_id}"]`);s&&(s.setAttribute("data-rented",e.rented),s.setAttribute("data-room-id",e.room_id),s.classList.add(D(+e.rented)))})),e.length&&e.forEach((e=>{const t=o.querySelector(`.warehouse__svg-cell[data-cell-num="${e.room_id}"]`);t&&(t.setAttribute("data-room-id",e.room_id),t.classList.remove("my","free","busy","disabled","_selected"),.25===e.rented?(t.classList.add("free"),this.handlerClickToCellFree(e.room_id,t)):t.classList.add(D(2)))}))}renderRooms(e){const[t]=this.clientData.agreements.filter((t=>t.agrid===e)),o=this.clientData.rooms.filter((t=>t.agrid===e));if(!this.warehouses||!o.length)return;const s=o.filter((e=>1===e.floor)),r=o.filter((e=>2===e.floor));this.storeroomsTitleAgreement.innerHTML=`Оферта ${t.agrid}`,this.agrId=t.num_agrid,s.length?this.schemeTabs.switchTabs(document.querySelector('.tabs-btn-schemes[data-tabs-btn="account-schemes-tabs-0"]')):this.schemeTabs.switchTabs(document.querySelector('.tabs-btn-schemes[data-tabs-btn="account-schemes-tabs-1"]')),this.renderScheme(s,this.warehouses[0].rooms,this.schemeOne),this.renderScheme(r,this.warehouses[1].rooms,this.schemeTwo)}handlerClickToCellFree(e,t){if(this.account.querySelector(".scheme-room-new")&&this.account.querySelector(".scheme-room-new").remove(),t.classList.contains("_selected"))t.classList.remove("_selected"),this.routeScheme.deletePath(t),this.newRoomId=null;else{const[o]=this.warehouses[this.targetFloor-1].rooms.filter((t=>+t.room_id==+e)),s=this.account.querySelector(".warehouse__svg-cell.free._selected");this.storeroomsSchemeRooms.insertAdjacentHTML("beforeend",function(e,t=!0){return`<div class="scheme-room scheme-room-new" data-room-id="${e.room_id&&e.room_id}">\n                <div class="scheme-room__top">\n                  <h5>${e.room_id?"Кладовка "+e.room_id:""}</h5>\n                  <p>${e.dimensions?e.dimensions:""}</p>\n                  <div>\n                    <span>${e.volume?e.volume+" м³":""}</span>\n                    <span>${e.floor&&e.floor+" ярус"}</span>\n                  </div>\n                </div>\n                <div class="scheme-room__bottom">\n                  <b>от ${e.price_11m?(0,n.F)(e.price_11m):""}</b>\n  <button class="button btn-rent-room btn-modal-payments-room-open link-rent-storage-room" data-room-id="${e.room_id&&e.room_id}">\n    <span>Арендовать</span>\n  </button>\n                  ${t?`<button class="button btn-replace-room" data-room-id="${e.room_id&&e.room_id}">\n                    <span>Заменить</span>\n                  </button>`:""}                  \n                </div>\n              </div>`}(o,this.isReplace));const r=this.account.querySelector(".scheme-room-new .btn-rent-room"),a=this.account.querySelector(".scheme-room-new .btn-replace-room");this.account.querySelector(".scheme-room-old")&&r&&this.isReplace&&r.classList.add("_none"),s&&(s.classList.remove("_selected"),this.routeScheme.deletePath(s)),this.clientData.rooms.length||a&&a.classList.add("_none"),t.classList.add("_selected"),this.routeScheme.drawing([t])}}handlerClickToCellMy(e,t){this.account.querySelector(".scheme-room-old")&&this.account.querySelector(".scheme-room-old").remove();const o=this.account.querySelector(".scheme-room-new .btn-rent-room");if(t.classList.contains("_selected"))o&&o.classList.remove("_none"),t.classList.remove("_selected"),this.oldRoomId=null,this.routeScheme.deletePath(t);else{const[r]=this.clientData.rooms.filter((t=>+t.room_id==+e)),a=this.account.querySelector(".warehouse__svg-cell.my._selected");this.oldRoomId=+e,this.storeroomsSchemeRooms.insertAdjacentHTML("afterbegin",`<div class="scheme-room scheme-room-old" data-room-id="${(s=r).room_id?s.room_id:""}">\n                <div class="scheme-room__top">\n                  <h5>${s.room_id?"Кладовка "+s.room_id:""}</h5>\n                  <p>${s.dimensions?s.dimensions:""}</p>\n                  <div>\n                    <span>${s.volume?s.volume+" м³":""}</span>\n                    <span>${s.floor&&s.floor+" ярус"}</span>\n                  </div>\n                </div>\n                <div class="scheme-room__bottom">\n                  <button class="btn-complete-lease button" data-room-id="${s.room_id?s.room_id:""}"><span>Завершить аренду</span></button>\n                  <button class="btn-payment button btn-modal-payments-room-open" data-room-id="${s.room_id?s.room_id:""}" data-agreement-id="${s.agrid?s.agrid:""}" data-months="${s.rent_period?s.rent_period:""}"><span>Оплатить</span></button>\n                  \x3c!--<button class="account-storerooms__agreement_button-download btn-download-agreement" data-room-id="${s.room_id?s.room_id:""}">\n                    <img src="img/icons/pdf.png" alt="Иконка">\n                    <span>Скачать договор</span>\n                  </button>--\x3e\n                </div>\n              </div>`);const n=this.storeroomsSchemeRooms.querySelector(".scheme-room.scheme-room-old"),i=n?.querySelector(".btn-complete-lease")||null;1!==r&&i&&i.classList.add("_none"),o&&this.isReplace&&o.classList.add("_none"),a&&(a.classList.remove("_selected"),this.routeScheme.deletePath(a)),t.classList.add("_selected"),this.routeScheme.drawing([t])}var s}async handlerClickToBtnReplaceRoom(e){try{if(!e)return;const[t]=[...this.warehouses[0].rooms,...this.warehouses[1].rooms].filter((t=>+t.room_id==+e));if(this.oldRoomId){this.loader.enable();const[o]=this.clientData.rooms.filter((e=>+e.room_id==+this.oldRoomId)),s=await a.hU.post("/_get_room_prices_difference_",{agrid:o.agrid,old_room_id:this.oldRoomId,new_room_id:t.room_id});if(200!==s.status)return;const{difference:r,old_amount:i,old_deposit:c,new_amount:l,new_deposit:d}=s.data,m=this.modalConfirmReplaceRoom.modal.querySelector(".btn-replace-confirm");this.modalConfirmReplaceRoom.modal.querySelector(".modal-confirm-replace-room__text").innerHTML=`\n          <p>Вы уверены, что хотите заменить<br> Кладовка ${o.room_id} на Кладовка ${t.room_id}?</p>\n          <p style="display: flex; align-items: center; gap: 6px;">\n            <b>${r<0?`Экономия составит  ${(0,n.F)(-1*r)}`:`Доплата составит ${(0,n.F)(r)}`} </b><svg class='icon icon-info  icon-info-tippy' style="width: 30px; height: 40px;">\n            <use xlink:href='img/svg/sprite.svg#info'></use>\n            </svg>\n          </p>`,(0,p.Ay)(".icon-info-tippy",{content:`<div style="display: grid; grid-template-columns: auto 1fr; gap: 6px; background-color: #fff; padding: 5px; border: 1px solid #004d56;\n    box-shadow: 4px 4px 5px 0 rgba(0, 0, 0, 0.25); border-radius: 4px; font-size: 12px;">\n          <b>${(0,n.F)(+i)}</b><span>Старый арендный платеж</span>\n          <b>${(0,n.F)(+c)}</b><span>Старый депозит</span>\n          <hr style="width: 100%; height: 1px; background-color: #000; grid-column-start: span 2;">\n          <b>${(0,n.F)(+l)}</b><span>Новый арендный платеж</span>\n          <b>${(0,n.F)(+d)}</b><span>Новый депозит</span>\n          </div>`,allowHTML:!0}),m.setAttribute("data-agreement-id",o.agrid),m.setAttribute("data-room-id",e),m.setAttribute("data-old-room-id",this.oldRoomId),m.setAttribute("data-new-room-id",this.newRoomId),m.setAttribute("data-difference",r),r>0?(m.classList.add("btn-modal-payments-room-open"),m.classList.remove("btn-modal-replace-room")):(m.classList.remove("btn-modal-payments-room-open"),m.classList.add("btn-modal-replace-room")),this.modalConfirmReplaceRoom.open()}else{const e=this.modalSelectRoom.modal.querySelector(".content-rooms-modal");let t=[];e.innerHTML="",t=this.agrId?this.clientData.rooms.filter((e=>e.agrid==this.agrId&&1==e.rented)):this.clientData.rooms.filter((e=>1==e.rented)),t.length&&t.forEach((t=>{var o;e.insertAdjacentHTML("beforeend",`\n  <div class="warehouse__rooms_room room-modal" data-room-id="${(o=t).room_id&&o.room_id}">\n              <div class="warehouse__rooms_room-content">\n                <span class="warehouse__rooms_room-num">${o.room_id&&"№"+o.room_id}</span>\n                <span class="warehouse__rooms_room-area">${o.area?o.area+" м²":""}</span>\n                <div class="warehouse__rooms_room-block dimensions">\n                  <span>размер кладовки</span>\n                  <b>${o.dimensions?o.dimensions:""} м</b>\n                </div>\n                <div class="warehouse__rooms_room-block floor">\n                  <span>ярус</span>\n                  <b>${o.floor?o.floor:""}</b>\n                </div>\n              </div>\n              <button class="warehouse__rooms_room-link button btn-replace-room-modal btn-modal-close" data-room-id="${o.room_id&&o.room_id}">\n                <span>Заменить</span>\n              </button>\n            </div>`)})),this.modalSelectRoom.open()}}catch(e){console.log(e)}finally{this.loader.disable()}}rentNewRoom({agrId:e}){const[t]=[...this.warehouses[0].rooms,...this.warehouses[1].rooms].filter((e=>+e.room_id==+this.newRoomId));if(!t)return;let o={user_type:this.clientData.client.user_type,agrid:e,old_room_id:this.oldRoomId,new_room_id:this.newRoomId};"f"===this.clientData.client.user_type&&(o.return_url=location.href),(0,M.S8)(o,this.loader)}async renderAgreement({clientTotalData:e,formNewAgreement:t}){try{this.loader.enable();const[...o]=await Promise.all([w((0,y.D)({floor:1})),w((0,y.D)({floor:2}))]);if(!e)return;this.agreements.innerHTML="",this.storeroomsSliderWrapper.innerHTML="",e.agreements.length&&e.agreements.forEach((t=>{this.agreements.insertAdjacentHTML("beforeend",function(e,{rooms:t}){const o=t.reduce(((t,o)=>o.agrid===e.agrid?t+ +o.price:t),0),s=t.length?t.map(((t,o)=>t.agrid===e.agrid?"Кладовка "+t.room_id:"")).filter((e=>""!==e)):[],r=t.length?t.filter((t=>t.agrid===e.agrid)):[];return`\n  <div class="account-storerooms__agreement agreement-account-storerooms agreement-accordion _my-accordion" data-agreement-id="${e.agrid?e.agrid:""}">\n  <div class="account-storerooms__agreement_control agreement-accordion-control _my-accordion-control">\n    <h2 class="agreement2__row__right-col__title">${e.agrid?`Оферта ${e.agrid}`:""}</h2>\n    <span>${s.length?s.join(" • "):"Нет ячеек"}</span>\n    <svg class='icon icon-arrow-left'>\n      <use xlink:href='img/svg/sprite.svg#arrow-left'></use>\n    </svg>\n  </div>\n  <div class="account-storerooms__agreement_content agreement-accordion-content _my-accordion-content">\n  <div class="agreement2__row__right-col__block-desc">\n    <p>Стоимость: <span> ${o?(0,n.F)(o):""}</span></p>\n    <p>Осталось дней: <span> ${e.days_left?e.days_left:""}</span></p>\n    <p>Дата следующего платежа: <span>${e.next_payment_date?b(e.next_payment_date):""}</span></p>\n    <p>Плановая дата окончания: <span> ${e.agrplanenddate?b(e.agrplanenddate):""}</span></p>\n  </div>\n  \x3c!--<div class="account-storerooms__agreement_row">\n    <button class="account-storerooms__agreement_button-download btn-download-agreement" data-agreement-id="${e.agrid?e.agrid:""}" \n    data-room-id="${r.length?r[0].room_id:""}">\n      <img src="img/icons/pdf.png" alt="Иконка">\n      <span>Скачать договор</span>\n    </button>\n  </div>--\x3e\n  <div class="agreement2__row__right-col__block-cards account-storerooms__agreement_form-payment form-payment-account-storerooms">\n    <div class="row-price">\n      <p class="p1">К оплате</p>\n      <p class="p1 price">${o?(0,n.F)(o):""}</p>\n    </div>\n    <div class="flex-buttons" style="margin-top: 10px;">\n    <button style="flex: 1 1 50%;" class="agreement2__row__right-col__btn account-storerooms__agreement_button-payment btn-payment btn-modal-payments-room-open button-2" data-agreement-id="${e.agrid?e.agrid:""}" data-months="${t[0]?.rent_period}" data-room-ids="${e.room_ids.length?e.room_ids.join(","):""}"><span>Оплатить</span></button>\n    <button style="flex: 1 1 50%;" class="agreement2__row__right-col__btn account-storerooms__agreement_button-payment btn-cancel-autopayments button-2" data-agreement-id="${e.agrid?e.agrid:""}"><span>Отменить автоплатежи</span></button> \n    </div>\n  </div>\n  <div class="account-storerooms__agreement_total-info-data">\n    <h4>Всего по оферте</h4>\n    <span>Кладовки, ${s.length} шт</span>\n    <b>Итого ${o?(0,n.F)(o):""}</b>\n  </div>\n  <div class="account-storerooms__rooms">\n  ${t.length?t.map((t=>t.agrid===e.agrid?f(t):"")).join(""):""}\n  </div>\n  </div>\n  </div>`}(t,e))})),e.test_rooms.length&&e.test_rooms.forEach((e=>{this.agreements.insertAdjacentHTML("beforeend",f(e,"not-close"))})),e.rooms.length?L(e.rooms,1)&&(this.isReplace=!0):document.querySelector(".account-storerooms-rooms").style.display="none",this.clientData=e,this.warehouses=o||null,this.oldRoomId=null,this.newRoomId=null,this.agrId=null,this.accordionRoom.init(),this.accordionAgreement.init(),this.paymentTabs.init(),this.storeroomsTitleAgreement.innerHTML="",this.storeroomsSchemeRooms.innerHTML="",t.allRooms=[...this.warehouses[0].rooms,...this.warehouses[1].rooms],this.renderScheme([...e.rooms,...e.test_rooms],this.warehouses[0].rooms,this.schemeOne),this.renderScheme([...e.rooms,...e.test_rooms],this.warehouses[1].rooms,this.schemeTwo),(0,g.B)(".room-accordion-control>p span",{breakpoints:[768]}),(0,g.B)(".room-accordion-control .title-product",{breakpoints:[768],breakpointsNone:580}),(0,g.B)(".agreement-accordion-control .agreement2__row__right-col__title",{breakpoints:[768],breakpointsNone:480})}catch(e){console.error(e)}finally{this.loader.disable()}}async cancelRecurrentPayments(e){try{this.loader.enable();const t=await a.hU.post("/_cancel_recurrent_payments_",e);if(200!==t.status)return;(0,c.G)(t.data)}catch(e){console.error(e)}finally{this.loader.disable()}}};var $=o(482);const R=class{constructor({accountTabs:e}){this.loader=new r.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed",id:"change-password-loader"}),this.form=document.querySelector(".form-change-password"),this.validator=function(e){if(!e)return;const t=new $.Ay(e);return t.addField(e.querySelector('input[name="current_password"]'),[{rule:"required",errorMessage:"Введите старый пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]).addField(e.querySelector('input[name="password"]'),[{rule:"required",errorMessage:"Введите новый пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]).addField(e.querySelector('input[name="repassword"]'),[{rule:"required",errorMessage:"Повторите новый пароль"},{validator:t=>t===e.querySelector('input[name="password"]').value,errorMessage:"Пароли не совпадают"}]),t}(this.form),this.accountTabs=e,this.isCreatePassword=!1,this.events()}events(){this.form&&this.form.addEventListener("submit",(e=>{this.validator.revalidate().then((e=>{if(!e)return;const t=new FormData(this.form);this.sendForm(t)}))}))}renderForm(){this.form&&this.form.classList.contains("create-password")&&(this.form.querySelector("h2").textContent="Создайте пароль",this.form.querySelector('input[name="current_password"]')?.closest(".wrap-input")?.remove(),this.form.querySelector('button[type="submit"]').insertAdjacentHTML("beforebegin",'<p style="text-align: center; margin-bottom: 10px;">* Длина пароля не менее 5 знаков</p>'),this.isCreatePassword=!0,this.validator=function(e){if(!e)return;const t=new $.Ay(e);return t.addField(e.querySelector('input[name="password"]'),[{rule:"required",errorMessage:"Введите новый пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]).addField(e.querySelector('input[name="repassword"]'),[{rule:"required",errorMessage:"Повторите новый пароль"},{validator:t=>t===e.querySelector('input[name="password"]').value,errorMessage:"Пароли не совпадают"}]),t}(this.form))}async sendForm(e){try{this.loader.enable();const t=await a.hU.post(this.isCreatePassword?"/_set_password_":"/_change_password_",e);if(200!==t.status)return;this.form.reset(),this.validator.refresh(),(0,c.G)(t.data),this.isCreatePassword&&location.reload()}catch(e){console.error("Ошибка при смене пароля:",e)}finally{this.loader.disable()}}};var A=o(836),k=o(700);class C{constructor(e){e&&(this.watch=e.querySelector(".watch"),this.watch&&(this.countDays=this.watch.querySelectorAll(".count-days"),this.countHours=this.watch.querySelectorAll(".count-hours"),this.countMinutes=this.watch.querySelectorAll(".count-minutes"),this.countSeconds=this.watch.querySelectorAll(".count-seconds"),this.timeDays=this.watch.querySelector(".time-days"),this.timeHours=this.watch.querySelector(".time-hours"),this.timeMinutes=this.watch.querySelector(".time-minutes"),this.timeSeconds=this.watch.querySelector(".time-seconds"),this.newData=null,this.interval=null))}updateTime(e,t,o,s){if(e<10)t[0].innerHTML="<span>0<span>",t[1].innerHTML=`<span>${e}<span>`;else{let o=e.toString();t[0].innerHTML=`<span>${o[0]}<span>`,t[1].innerHTML=`<span>${o[1]}<span>`}o.textContent=(0,k.Y)(e,s)}timeCount(){let e=new Date,t=this.newData-e,o=Math.floor(t/1e3/60/60/24),s=Math.floor(t/1e3/60/60)%24,r=Math.floor(t/1e3/60)%60,a=Math.floor(t/1e3)%60;this.updateTime(o,this.countDays,this.timeDays,["день","дня","дней"]),this.updateTime(s,this.countHours,this.timeHours,["час","часа","часов"]),this.updateTime(r,this.countMinutes,this.timeMinutes,["минута","минуты","минут"]),this.updateTime(a,this.countSeconds,this.timeSeconds,["секунда","секунды","секунд"])}init(e){this.newData=new Date(e),this.timeCount(),clearInterval(this.interval),this.interval=setInterval((()=>this.timeCount()),1e3)}}const P=new Date;function F(e,t){const o=new Date(e);return o.setDate(e.getDate()+t),o}const I=class{constructor(){this.accountDepartures=document.querySelector(".account-departures"),this.accountDepartures&&(this.loader=new r.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed",id:"departure-loader"}),this.modalConfirmCheckOut=new i.a(".modal-confirm-check-out",{modalBtnClose:".btn-modal-close"}),this.departuresTabs=null,this.accountDeparturesTabs=document.querySelector(".account-departures-tabs"),this.accountDeparturesRooms=document.querySelector(".account-departures-rooms"),this.accountDeparturesStepTwo=document.querySelector(".account-departures-step-2"),this.accountDeparturesStepThree=document.querySelector(".account-departures-step-3"),this.formMovingOutRoomPhoto=document.querySelector(".form-moving-out-room-photo"),this.inputFile=this.accountDepartures.querySelector(".input-file"),this.watchStepTwo=new C(this.accountDeparturesStepTwo),this.watchStepThree=new C(this.accountDeparturesStepThree),this.roomId=null,this.dataSend={room_id:null,leave_date:null,leave_reason:"Больше нет потребности в услуге",comment:null},this.departuresTabs=new s.t("account-tabs",{btnSelector:".account-departures-tab",contentSelector:".account-departures-room"}),this.rooms=[],this.isFile=!1,this.events())}events(){this.accountDepartures.addEventListener("click",(e=>{if(e.target.closest(".btn-to-leave")&&this.departuresTabs.tabsContentActive){const e=this.departuresTabs.tabsContentActive.querySelector('input[name="leave_date"]');""!==e.value?(this.dataSend.room_id=this.departuresTabs.tabsContentActive.getAttribute("data-room-id"),this.dataSend.leave_date=function(e){if(e){if(e.includes("-")){const t=e.split("-");return`${t[2]}-${t[1]}-${t[0]}`}{const t=e.split("-");return`${t[2]}-${t[1]}-${t[0]}`}}}(e.value),e.value="",this.endRent(this.dataSend)):e.classList.add("just-validate-error-field")}if(e.target.closest(".btn-cancel-check-out")){const t=e.target.closest(".btn-cancel-check-out").getAttribute("data-room-id");this.modalConfirmCheckOut.modal.querySelector(".button.btn-yes").setAttribute("data-room-id",t),this.modalConfirmCheckOut.open()}if(e.target.closest(".btn-complete-lease-departures"))if(this.isFile){const t=e.target.closest(".btn-complete-lease-departures").getAttribute("data-room-id"),o=new FormData(this.formMovingOutRoomPhoto);o.set("room_id",t),this.provide_moving_out_room_photo_(o,t)}else this.formMovingOutRoomPhoto.classList.add("_err")})),this.inputFile&&this.inputFile.addEventListener("change",(e=>{if(this.inputFile.files.length){const t=this.formMovingOutRoomPhoto.querySelector("img"),o=new FileReader;let s=e.target.files[0];o.onload=e=>{t.src=e.target.result,t.alt="Кладовка"},o.readAsDataURL(s),this.isFile=!0,this.formMovingOutRoomPhoto.classList.remove("_err"),this.formMovingOutRoomPhoto.classList.add("_success")}else this.isFile=!1,this.formMovingOutRoomPhoto.classList.add("_err"),this.formMovingOutRoomPhoto.classList.remove("_success")})),this.departuresTabs.options.onInit=(e,t)=>{const o=this.departuresTabs.tabsContentActive.getAttribute("data-room-id");if(o&&this.rooms.length){const[e]=this.rooms.filter((e=>+e.room_id==+o));e?.rentenddate&&(t.classList.remove("_tab-content-active"),e?.room_photo_uploaded?(this.accountDeparturesStepThree.classList.remove("_none"),this.watchStepThree.init(e.rentenddate)):this.watchStepTwo.init(e.rentenddate),this.setRoomId(o))}},this.modalConfirmCheckOut.modal.querySelector(".button.btn-yes").addEventListener("click",(e=>{const t=e.target.getAttribute("data-room-id");t&&this.cancelMovingOut(t)}))}renderDeparture({clientTotalData:e,roomId:t=null}){if(!e)return;const{rooms:o}=e;if(!o||!o?.length)return;this.rooms=o;let s=0;this.accountDeparturesTabs.innerHTML="",this.accountDeparturesRooms.innerHTML="",o.length&&o.forEach(((e,o)=>{var r;this.accountDeparturesTabs.insertAdjacentHTML("beforeend",`\n  <div class="payment-method__row__right-col__row-top__block account-departures-tab"  data-room-id="${(r=e).room_id?r.room_id:""}">\n                  <p class="num">№${r.room_id?r.room_id:""}</p>\n                  <div class="payment-method__row__right-col__row-top__block__row-bottom">\n                    <p>${r.volume?r.volume+" м<sup>3</sup>":""}</p>\n                    <p>${r.floor} ярус</p>\n                  </div>\n                </div>`),this.accountDeparturesRooms.insertAdjacentHTML("beforeend",function(e){return`<div class="payment-method__row__right-col__content account-departures__room account-departures-room"\n                  id="payment-method__row__right-col__content-2" data-room-id="${e.room_id?e.room_id:""}">\n                  <div class="payment-method__row__right-col__content-2__row-top">\n                    <p class="p1">Дата выезда</p>\n                    <label class="payment-method__row__right-col__content-2__row-top__block-data wrap-input">\n                      <input type="text" name="leave_date" placeholder="ДД.ММ.ГГ" class="input not-icon-date" autocomplete="off" readonly>\n                      <svg class='icon icon-calendar'>\n                        <use xlink:href='img/svg/sprite.svg#calendar'></use>\n                      </svg>\n                    </label>\n                    <button class="payment-method__row__right-col__content-2__row-top__btn btn-to-leave button-4">\n                      <span>Выехать</span>\n                    </button>\n                  </div>\n                  <div class="payment-method__row__right-col__product">\n                    <h2 class="title-product">${e.room_name?e.room_name:""}</h2>\n                    <div class="container-attributes">\n                      <div class="row">\n                        <p class="title-attribute">Площадь</p>\n                        <p class="value-attribute">${e.area?e.area+" м<sup>2</sup>":""}</p>\n                      </div>\n                      <div class="row">\n                        <p class="title-attribute">Объём</p>\n                        <p class="value-attribute">${e.volume?e.volume+" м<sup>3</sup>":""}</p>\n                      </div>\n                      <div class="row">\n                        <p class="title-attribute">Размер кладовки (ДхШхВ)</p>\n                        <p class="value-attribute">${e.dimensions?e.dimensions:""}</p>\n                      </div>\n                    </div>\n                  </div>\n                  <p class="payment-method__row__right-col__content__p-bottom">\n                    <span>Шаг 1: </span> Выберите кладовку и дату\n                  </p>\n                </div>`}(e)),t&&e.room_id===+t&&(s=o)})),this.departuresTabs.init(),this.departuresTabs.options.onChange=this.onChangeTabs.bind(this),this.departuresTabs.switchTabs(this.accountDepartures.querySelector(`${this.departuresTabs.options.btnSelector}[data-tabs-btn="account-tabs-${s}"]`)),this.accountDepartures.querySelectorAll('input[name="leave_date"]').forEach((e=>{this.createAirDatepicker(e)}))}async endRent(e){try{this.loader.enable();const t=await a.hU.post("/_end_rent_by_client_",e);if(200!==t.status)return;if((0,c.G)(t.data),"success"===t.data.msg_type){const t=this.rooms.findIndex((t=>+t.room_id==+e.room_id));this.rooms[t].rentenddate=e.leave_date,this.departuresTabs.tabsContentActive.classList.remove("_tab-content-active"),this.accountDeparturesStepTwo.classList.remove("_none"),this.watchStepTwo.init(this.dataSend.leave_date),this.setRoomId(e.room_id)}}catch(e){console.error(e)}finally{this.loader.disable()}}async provide_moving_out_room_photo_(e,t){try{this.loader.enable();const o=await a.hU.post("/_provide_moving_out_room_photo_",e);if(200!==o.status)return;if((0,c.G)(o.data),"success"===o.data.msg_type){const e=this.rooms.findIndex((e=>+e.room_id==+t));this.rooms[e].room_photo_uploaded=1,this.accountDeparturesStepTwo.classList.add("_none"),this.accountDeparturesStepThree.classList.remove("_none"),this.watchStepThree.init(this.rooms[e].rentenddate)}}catch(e){console.error(e)}finally{this.loader.disable()}}async cancelMovingOut(e){try{this.loader.enable();const t=await a.hU.post("/_cancel_moving_out_",{room_id:e});if(200!==t.status)return;if((0,c.G)(t.data),"success"===t.data.msg_type){const t=this.rooms.findIndex((t=>+t.room_id==+e));this.rooms[t].rentenddate=null,this.departuresTabs.tabsContentActive?.classList.add("_tab-content-active"),this.accountDeparturesStepTwo.classList.add("_none"),this.accountDeparturesStepThree.classList.add("_none"),this.watchStepTwo.init(this.dataSend.leave_date)}}catch(e){console.error(e)}finally{this.loader.disable()}}onChangeTabs(e,t,o,s){const r=e.getAttribute("data-room-id");if(!r||!this.rooms.length)return;const[a]=this.rooms.filter((e=>+e.room_id==+r));this.accountDeparturesStepTwo.classList.add("_none"),this.accountDeparturesStepThree.classList.add("_none"),a?.rentenddate&&(o.classList.remove("_tab-content-active"),a?.room_photo_uploaded?(this.accountDeparturesStepThree.classList.remove("_none"),this.watchStepThree.init(a.rentenddate)):(this.accountDeparturesStepTwo.classList.remove("_none"),this.watchStepTwo.init(a.rentenddate)),this.setRoomId(r))}setRoomId(e){const t=[...this.accountDepartures.querySelectorAll(".btn-cancel-check-out"),...this.accountDepartures.querySelectorAll(".btn-complete-lease-departures")];t.length&&t.forEach((t=>{t.setAttribute("data-room-id",e)}))}createAirDatepicker(e){const t=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return new A.A(e,{dateFormat:"dd-MM-yyyy",position:"bottom center",autoClose:!0,minDate:(o=F(P,14),`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`),isMobile:t,onSelect:({date:e,formattedDate:t,datepicker:o})=>{o.$el.classList.remove("just-validate-error-field")}});var o}};var x=o(304),H=o(241),E=o(943);const B=class{constructor(){this.accountMyData=document.querySelector(".account-my-data"),this.myDataTabs=new s.t("account-tabs",{btnSelector:".my-data-tabs-btn",contentSelector:".my-data-tabs-content"}),this.loader=new r.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed",id:"my-data-loader"}),this.forms=this.accountMyData.querySelectorAll(".form-account-data"),this.inputs=this.accountMyData.querySelectorAll(".my-data-input"),this.formPassportPhoto=this.accountMyData.querySelector(".form-passport-photo"),this.inputPhotoPassport=this.accountMyData.querySelector(".input-photo-passport"),this.formPassportsData=this.accountMyData.querySelector(".form-passorts-data"),this.formUrData=this.accountMyData.querySelector(".form-ur-data"),this.imgPassport=this.accountMyData.querySelector(".img-passport"),this.isRequiredPassportsData=!0,this.imgPassportFile=null,this.clientData=null,this.validators={},this.init()}init(){this.forms.length&&this.forms.forEach((e=>{const t=e.getAttribute("data-form-type");t&&(this.validators[t]=x.U[t](e))})),this.events()}events(){this.forms.length&&this.forms.forEach((e=>{e.addEventListener("submit",(t=>{t.preventDefault();const o=e.getAttribute("data-form-type");if(!o||!this.validators[o].isValid)return;const s=new FormData(e);s.set("change_type",o),"username"===o?s.set("new",s.get(o).replace(/[+() -]/g,"")):s.set("new",s.get(o)),s.delete(o),this.changeData(s)}))})),this.inputPhotoPassport.addEventListener("change",(e=>{const t=e.target.closest("form");if(e.target.files.length){const o=new FileReader,s=new FormData;let r=this.imgPassportFile=e.target.files[0];o.onload=e=>{this.imgPassport.src=e.target.result,this.imgPassport.alt="Фото паспорта"},o.readAsDataURL(r),s.append("file",r),this.isFile=!0,t.classList.remove("_err"),t.classList.add("_success"),this.isRequiredPassportsData&&this.uploadNewPassportPhoto(s)}else this.isFile=!1,t.classList.add("_err"),t.classList.remove("_success"),this.imgPassport.src="",this.imgPassport.alt="",this.imgPassportFile=null})),this.setValidator(),this.formPassportsData.addEventListener("submit",(e=>this.handleSubmit(e)))}handleSubmit(e){this.validator.revalidate().then((t=>{if(!t)return;const o=new FormData(e.target);if(!this.imgPassportFile&&!this.isRequiredPassportsData)return this.formPassportPhoto.classList.add("_err"),this.formPassportPhoto.classList.remove("_success"),void(this.imgPassport.src="");if(o.set("user_type","f"),this.isRequiredPassportsData){let e={};o.set("issue_date",(0,E.p)("YYYY-MM-DD",new Date(o.get("issue_date")))),Array.from(o).forEach((t=>e[t[0]]=t[1])),this.editClient(e)}else{const e=this.clientData.rooms.filter((e=>.45==e.rented)).map((e=>e.room_id));o.set("file",this.imgPassportFile),o.set("room_ids",JSON.stringify(e)),o.set("birthday",(0,E.p)("YYYY-MM-DD",new Date(o.get("birthday")))),o.set("issue_date",(0,E.p)("YYYY-MM-DD",new Date(o.get("issue_date")))),this.formNewAgreement(o)}}))}renderMyData({profile:e=null,clientTotalData:t=null}){if(!t)return;const{client:o}=this.clientData=t,s=this.accountMyData.querySelector(".btn-tabs-main-information"),r=this.accountMyData.querySelector(".btn-tabs-contacts-data"),a=this.accountMyData.querySelector(".my-data-tabs-btn.btn-tabs-requisites"),n=this.accountMyData.querySelector(".my-data-tabs-btn.btn-tabs-passport-data");this.isRequiredPassportsData||(s.classList.add("_none"),r.classList.add("_none"),a.classList.add("_none"),this.myDataTabs.switchTabs(n)),this.inputs.length&&this.inputs.forEach((t=>{const o=e[t.name]?e[t.name]:"";"username"===t.name?t.value=o?o.slice(1):"":t.classList.contains("input-date")?t.value=o?(0,E.p)("DD-MM-YYYY",new Date(o)):"":t.value=o})),o.passp_photo_link&&(this.imgPassport.src=o.passp_photo_link,this.imgPassport.closest("form").classList.add("_success")),"u"===e?.user_type?(n.classList.add("_none"),a.classList.remove("_none")):"f"===e?.user_type?(n.classList.remove("_none"),a.classList.add("_none")):(n.classList.remove("_none"),a.classList.remove("_none"))}setValidator(){this.isRequiredPassportsData||this.changePassportsData(),this.validator=this.isRequiredPassportsData?(0,H.S1)(this.formPassportsData):(0,H.O7)(this.formPassportsData)}changePassportsData(){this.formPassportsData.insertAdjacentHTML("afterbegin",'<div class=" wrap-input">\n                    <input type="text" name="familyname" class="input input-agreement-conclusion my-data-input"\n                      placeholder="Фамилия">\n                  </div>\n                  <div class="wrap-input">\n                    <input type="text" name="firstname" class="input input-agreement-conclusion my-data-input"\n                      placeholder="Имя">\n                  </div>\n                  <div class="wrap-input">\n                    <input type="text" name="patronymic" class="input input-agreement-conclusion my-data-input"\n                      placeholder="Отчество">\n                  </div>\n                  <div class=" wrap-input">\n                    <input type="text" name="birthday"\n                      class="input input-agreement-conclusion not-icon-date input-date my-data-input"\n                      placeholder="Дата рождения">\n                  </div>\n                  <div class=" wrap-input wrap-input-last">\n                    <input type="text" name="address" class="input input-agreement-conclusion my-data-input"\n                      placeholder="Адрес регистрации">\n                  </div>'),this.inputs=this.accountMyData.querySelectorAll(".my-data-input")}async changeData(e){try{this.loader.enable();const t=await a.hU.post("/_change_data_",e);if(200!==t.status)return;(0,c.G)(t.data)}catch(e){console.error(e)}finally{this.loader.disable()}}async uploadNewPassportPhoto(e){try{this.loader.enable();const t=await a.hU.post("/_upload_new_passport_photo_",e);if(200!==t.status)return;(0,c.G)(t.data)}catch(e){console.error(e)}finally{this.loader.disable()}}async formNewAgreement(e){try{this.loader.enable();const t=await a.hU.post("/_form_new_agreement_",e);if(200!==t.status)return null;(0,c.G)(t.data),"success"===t.data.msg_type&&location.reload()}catch(e){console.error(e)}finally{this.loader.disable()}}async editClient(e){try{this.loader.enable();const t=await a.hU.post("/_edit_client_by_client_",{client:e});if(200!==t.status)return null;(0,c.G)(t.data)}catch(e){console.error(e)}finally{this.loader.disable()}}};var O=o(194),N=o(220);const U=class{constructor(){this.accountPaymentMethods=document.querySelector(".account-payment-methods"),this.paymentMethodsTabs=new s.t("account-tabs",{btnSelector:".payment-methods-tabs-btn",contentSelector:".payment-methods-tabs-content"}),this.accordion=new _.n(".account-payment-methods"),this.loader=new r.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed",id:"payment-methods-loader"}),this.cards=new N.A(this.accountPaymentMethods.querySelector(".payment-methods-tabs-content"),{isLinkCard:!1}),this.tabsButtons=document.querySelector(".payment-methods-tabs-buttons"),this.formLinkNewBankingDetails=document.querySelectorAll(".form-link-new-banking-details"),this.paymentBankTransfer=this.accountPaymentMethods.querySelector(".payment-bank-transfer"),this.events()}events(){this.formLinkNewBankingDetails.length&&this.formLinkNewBankingDetails.forEach((e=>{const t=function(e){if(!e)return;const t=new $.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),o=e.querySelector('input[name="bik"]'),s=e.querySelector('input[name="bank"]'),r=e.querySelector('input[name="rs"]'),a=e.querySelector('input[name="ks"]');return t.addField(o,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>9?o.value=e.slice(0,9):o.value=e.replace(/[^0-9]/g,""),9===o.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(s,[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё\s]+$/,errorMessage:"Неверный формат"}]).addField(r,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>20?r.value=e.slice(0,20):r.value=e.replace(/[^0-9]/g,""),20===r.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(a,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>20?a.value=e.slice(0,20):a.value=e.replace(/[^0-9]/g,""),20===a.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]),t}(e);e.addEventListener("submit",(o=>{if(t.isValid){const s=new FormData(o.target);this.addRequisites(s).then((o=>{"success"===o.msg_type&&(e.reset(),t.refresh())}))}}))})),this.accountPaymentMethods.addEventListener("click",(e=>{if(e.target.closest(".btn-link-card")){const e=new FormData;e.append("return_url",location.href),this.attachCard(e)}})),document.addEventListener("change",(e=>{"requisites"===e.target.name&&this.makeRequisitesActive(e.target.value)}))}async addRequisites(e){try{this.loader.enable();const t=await a.hU.post("/_add_requisites_",e);if(200!==t.status)return;return(0,c.G)(t.data),(t.data.msg_type="success")&&this.renderPaymentMethods(),t.data}catch(e){console.error(e)}finally{this.loader.disable()}}async renderPaymentMethods({clientTotalData:e}){try{if(this.loader.enable(),await this.cards.render(),!e)return;const{client:t,requisites:o}=e;this.paymentBankTransfer.innerHTML="","f"===t.user_type?(this.tabsButtons.classList.add("_none"),this.paymentMethodsTabs.switchTabs(document.querySelector('.payment-methods-tabs-btn[data-tabs-btn="account-tabs-0"]'))):"u"===t.user_type?(this.tabsButtons.classList.add("_none"),this.paymentMethodsTabs.switchTabs(document.querySelector('.payment-methods-tabs-btn[data-tabs-btn="account-tabs-1"]'))):this.tabsButtons.classList.remove("_none"),o?.length&&o.forEach((e=>{this.paymentBankTransfer.insertAdjacentHTML("beforeend",(0,O.O)(e))}))}catch(e){console.error(e)}finally{this.loader.disable()}}async makeRequisitesActive(e){try{this.loader.enable();const t=await a.hU.post(`/_make_requisites_active_/${e}`);if(200!==t.status)return;(0,c.G)(t.data)}catch(e){console.error(e)}finally{this.loader.disable()}}async attachCard(e){try{this.loader.enable();const t=await a.hU.post("/_attach_card_",e);if(200!==t.status)return;"success"===t.data.msg_type&&(location.href=t.data.payment_url)}catch(e){console.error(e)}finally{this.loader.disable()}}},W=class{constructor(){this.modalPaymentsRoom=new i.a(".modal-payments-room",{modalBtnClose:".btn-modal-close",modalBtnActive:".btn-modal-payments-room-open",isHidden:!0}),this.modalPaymentsRoom.modal&&(this.accordion=new _.n(".modal-payments-room"),this.loader=new r.a(this.modalPaymentsRoom.modal.querySelector(".modal__body")),this.urlParams=new URLSearchParams(window.location.search),this.cards=new N.A(this.modalPaymentsRoom.modal.querySelector(".account-storerooms__agreement_form-payment"),{isLinkCard:!0}),this.form=this.modalPaymentsRoom.modal.querySelector(".modal-payments-room__form"),this.btnPaymentModal=this.modalPaymentsRoom.modal.querySelector(".btn-payment-modal"),this.priceResult=this.form.querySelector(".price-result"),this.inputMonth=this.form.querySelector('input[name="num_monthes"]'),this.itemsMonth=this.form.querySelectorAll(".item-month"),this.inputAutoPayments=this.form.querySelector('input[name="auto-payments"]'),this.submitEvent=new Event("submit"),this.allRooms=null,this.clientData=null,this.profile=null,this.priceRoom=null,this.agrId=null,this.roomId=null,this.month=null,this.oldRoomId=null,this.newRoomId=null,this.typePayment="before",this.events())}events(){this.form&&(this.modalPaymentsRoom.options.onOpen=e=>{const t=e.target?.closest(this.modalPaymentsRoom.options.modalBtnActive),o=t.getAttribute("data-agreement-id"),s=(t.getAttribute("data-room-ids"),t.getAttribute("data-room-id")),r=t.getAttribute("data-old-room-id"),a=t.getAttribute("data-new-room-id");let n=0;if(t.classList.contains("btn-rent-room"))location.href=`${location.origin}/rent-room.html?ids=${encodeURIComponent(JSON.stringify([s]))}`;else if(this.clientData.rooms=this.clientData.rooms.filter(((e,t,o)=>t===o.map((e=>e.room_id)).indexOf(e.room_id))),this.clientData.client.user_type){if(this.clientData.agreements){let e,t;if(o?([t]=this.clientData.agreements.filter((e=>e.agrid==o)),e=this.clientData.rooms.filter((e=>+e.room_id==+t.room_ids[0]))):[e]=this.clientData.rooms.filter((e=>+e.room_id==+s))[t]=this.clientData.agreements.filter((t=>t.agrid==e.agrid)),t&&.4==e[0]?.rented)return void(location.href=`${location.origin}/rent-room.html?ids=${encodeURIComponent(JSON.stringify(t.room_ids))}`)}if(this.modalPaymentsRoom.modal.classList.add("_active"),r&&a)n=+t.getAttribute("data-difference"),this.oldRoomId=r,this.newRoomId=a,this.typePayment="replace";else if(o){const[e]=this.clientData.rooms.filter((e=>e.agrid===o)),[t]=this.clientData.agreements.filter((e=>e.agrid==o));n=e.price,t.recurrent_payments?this.modalPaymentsRoom.modal.querySelector(".privacy-policy").classList.add("_none"):this.modalPaymentsRoom.modal.querySelector(".privacy-policy").classList.remove("_none"),this.typePayment="after",this.month=e.rent_period}else{const[e]=this.allRooms.filter((e=>+e.room_id==+s));n=e.price,this.typePayment="before"}this.roomId=s,this.agrId=o,this.renderModal({price:n,roomId:s})}else{let e=[];if(o){const[t]=this.clientData.agreements.filter((e=>+e.agrid==+o));e=t.room_ids}else e=[s];location.href=`${location.origin}/rent-room.html?ids=${encodeURIComponent(JSON.stringify(e))}`}},this.form.addEventListener("click",(e=>{if(e.target.closest(".item-month")){const t=e.target.closest(".item-month"),o=t.getAttribute("data-month"),s=this.form.querySelector(".item-month._active"),r=+t.getAttribute("data-price");if(!o||!r)return;this.inputMonth.classList.remove("just-validate-error-field"),this.inputMonth.value=o,this.month=o,s&&s.classList.remove("_active"),t&&t.classList.add("_active"),this.priceResult.innerHTML=(0,n.F)(r)}})),this.inputMonth&&this.inputMonth.addEventListener("input",(e=>{const t=this.form.querySelector(".item-month._active"),o=this.form.querySelector(`.item-month[data-month="${this.inputMonth.value}"]`),s=this.inputMonth.value;this.inputMonth.value.length>2?this.inputMonth.value=s.slice(0,2):this.inputMonth.value=s.replace(/[^0-9]/g,""),this.month=s,s<6?this.sumPriceDiscCells=this.priceRoom:+s>=6&&+s<=10?this.sumPriceDiscCells=this.priceRoom-(5*this.priceRoom/100).toFixed(0):s>10&&(this.sumPriceDiscCells=this.priceRoom-(10*this.priceRoom/100).toFixed(0)),this.inputMonth.classList.remove("just-validate-error-field"),t&&t.classList.remove("_active"),o&&o.classList.add("_active"),this.priceResult.innerHTML=(0,n.F)(this.sumPriceDiscCells)})),this.btnPaymentModal.addEventListener("click",(e=>{if(e.preventDefault(),!this.month&&"replace"!==this.typePayment&&"after"!==this.typePayment)return void this.inputMonth.classList.add("just-validate-error-field");const t=new FormData;if(t.set("autopay",this.inputAutoPayments.checked?1:0),t.set("user_type",this.clientData.client.user_type),t.set("num_monthes",this.month),t.delete("auto-payments"),t.delete("promo-code"),"f"===this.clientData.client.user_type)if("replace"===this.typePayment){let e={user_type:this.clientData.client.user_type,agrid:this.agrId,old_room_id:this.oldRoomId,new_room_id:this.newRoomId,autopay:this.inputAutoPayments.checked?1:0,card_id:this.cards.cardId,return_url:location.href};(0,M.S8)(e,this.loader).then((e=>{e&&"success"!==e.msg_type&&this.modalPaymentsRoom.close()}))}else"before"===this.typePayment?(t.set("return_url",location.href+`?room_id=${this.roomId}&num_monthes=${this.month}`),t.set("room_ids",JSON.stringify([this.roomId])),(0,M.KD)(t,this.loader)):(t.set("return_url",location.href),t.set("agrid",this.agrId),(0,M.pn)(t,this.loader).finally((()=>{this.modalPaymentsRoom.close()})));else if("u"===this.clientData.client.user_type)if("replace"===this.typePayment){let e={user_type:this.clientData.client.user_type,agrid:this.agrId,old_room_id:this.oldRoomId,new_room_id:this.newRoomId};(0,M.S8)(e,this.loader).finally((()=>{this.modalPaymentsRoom.close()}))}else"before"===this.typePayment?this.createAgreement({profile:this.profile,roomId:this.roomId,num_monthes:this.month}):(t.set("return_url",location.href),t.set("agrid",this.agrId),(0,M.pn)(t,this.loader).finally((()=>{this.modalPaymentsRoom.close()})));this.agrId=null,this.month=null,this.roomId=null})))}renderItemsMonth(e){this.itemsMonth.length&&this.itemsMonth.forEach((t=>{const o=+t.dataset.month,s=t.querySelector("b");let r=e;o&&(6==o?r=e-(5*e/100).toFixed(0):11==o&&(r=e-(10*e/100).toFixed(0)),s.innerHTML=`от ${(0,n.F)(r)}/м`,t.setAttribute("data-price",r))}))}renderModal({price:e,roomId:t}){this.roomId=t,this.priceRoom=+e,this.renderItemsMonth(e),this.priceResult.innerHTML=(0,n.F)(e),this.agrId?this.modalPaymentsRoom.modal.querySelector(".rent-room__tariffs").classList.add("_none"):this.modalPaymentsRoom.modal.querySelector(".rent-room__tariffs").classList.remove("_none"),"f"===this.clientData.client.user_type?this.modalPaymentsRoom.modal.querySelector(".payment-method-accordion").classList.add("_none"):"u"===this.clientData.client.user_type&&this.modalPaymentsRoom.modal.querySelector(".payment-method-accordion").classList.remove("_none"),this.cards.userType=this.clientData.client.user_type,this.cards.requisites=this.clientData.requisites,this.cards.render(this.loader)}createAgreement({profile:e,roomId:t,num_monthes:o}){const s=new FormData;s.set("num_monthes",o),s.set("room_ids",JSON.stringify(Array.isArray(t)?t:[t])),s.set("user_type",e.user_type),s.set("rent_or_test","rent"),s.set("familyname",e.familyname),s.set("firstname",e.firstname),s.set("address",e.address),"f"===e.user_type?(s.set("patronymic",e.patronymic),s.set("birthday",e.birthday),s.set("series",e.series),s.set("no",e.no),s.set("issue_date",e.issue_date),s.set("subdivision",e.subdivision),s.set("issued_by",e.issued_by)):"u"===e.user_type&&(s.set("bik",e.bik),s.set("inn",e.inn),s.set("kpp",e.kpp),s.set("bank",e.bank),s.set("rs",e.rs),s.set("ks",e.ks))}async formNewAgreement(e){try{this.loader.enable();const t=await a.hU.post("/_form_new_agreement_",e);if(200!==t.status)return null;(0,c.G)(t.data),"success"===t.data.msg_type&&(history.replaceState(null,"","/account.html"),location.href=location.origin+"/account.html")}catch(e){console.error(e)}finally{this.loader.disable()}}},j=class{constructor(){this.account=document.querySelector(".account"),this.account&&(this.urlParams=new URLSearchParams(window.location.search),this.formNewAgreement=new W,this.accountTabs=new s.t("account-tabs",{btnSelector:".account-tabs-btn",contentSelector:".account-tabs-content",wrapperTabBtnSelector:".pers-acc__row__left-col"}),this.accessStorage=new u,this.storerooms=new T,this.changePassword=new R({accountTabs:this.accountTabs}),this.myData=new B,this.paymentMethods=new U,this.departure=new I,this.accessStorage.myData=this.myData,this.loader=new r.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed",id:"account-loader"}),this.accountLink=document.querySelector(".account-link-header"),this.isAuth=(0,a.T5)(),this.profile=null,this.user=null,this.completeLeaseRoomId=null,this.init())}events(){this.account&&(this.accountTabs.options.onChange=(e,t,o,s)=>this.changeTabs(e,o),this.account.addEventListener("click",(e=>{if(e.target.closest(".btn-complete-lease")){const t=e.target.closest(".btn-complete-lease").getAttribute("data-room-id");this.completeLeaseRoomId=+t,this.accountTabs.switchTabs(this.account.querySelector(".account-departures-btn")),this.departure.renderDeparture({roomId:t})}})),this.accountLink&&this.accountLink.addEventListener("click",(e=>{e.preventDefault(),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.location.pathname="index.html"})),this.changeTabs(this.accountTabs.tabsBtnActive,this.accountTabs.tabsContentActive))}async init(){if(this.account){this.isAuth||(document.location.pathname="index.html"),this.accountLink&&(this.accountLink.classList.add("_exit"),this.accountLink.innerHTML="\n      <i>\n\t\t\t\t<svg class='icon icon-exit'>\n\t\t\t\t\t<use xlink:href='img/svg/sprite.svg#exit'></use>\n\t\t\t\t</svg>\n\t\t\t</i>\n\t\t\t<span>Выйти</span>");try{this.loader.enable(),await this.getProfile(),await this.initTabs(this.accountTabs.tabsBtnActive,this.accountTabs.tabsContentActive)}catch(e){this.loader.disable()}}}async getProfile(){try{const e=await a.hU.get("/_profile_");if(200!==e.status)return;const{user:t}=e.data,o=this.urlParams.get("room_id"),s=this.urlParams.get("num_monthes");this.profile=t,this.formNewAgreement.profile=t,o&&s&&this.formNewAgreement.createAgreement({profile:t,roomId:o,num_monthes:s}),!this.profile.own_password&&this.accountTabs.tabsBtns.length&&(this.accountTabs.tabsBtns.forEach((e=>{e.classList.contains("account-tabs-btn-change-password")?(e.innerHTML="<span>Создайте пароль</span>",document.querySelector(".form-change-password").classList.add("create-password")):e.classList.add("_none")})),this.accountTabs.switchTabs(this.accountTabs.tabs.querySelector(".account-tabs-btn-change-password")))}catch(e){console.error(e)}finally{this.events()}}async initTabs(e,t){try{this.loader.enable();const e=await v(),{rooms:t,test_rooms:o}=e,s=document.querySelector(".account-storerooms-rooms"),r=document.querySelector('[data-tabs-btn="account-tabs-0"]'),a=document.querySelector('.account-tabs-btn[data-tabs-btn="account-tabs-1"]'),n=document.querySelector('[data-tabs-btn="account-tabs-5"]');if(s.classList.remove("_none"),t.length){if(L(t)||L(t,.75)||n.classList.add("_none"),L(t,.45))return this.accountTabs.tabsBtns.forEach((e=>{e.classList.contains("account-tabs-btn-my-data")||e.classList.add("_none")})),this.myData.isRequiredPassportsData=!1,this.myData.validator.destroy(),this.myData.setValidator(),void this.accountTabs.switchTabs(this.accountTabs.tabs.querySelector(".account-tabs-btn-my-data"));if(!L(t)&&!L(o,.25)&&!L(t,.75))return r.classList.add("_none"),void this.accountTabs.switchTabs(a)}else s.classList.add("_none"),n.classList.add("_none"),o.length||(r.classList.add("_none"),this.accountTabs.switchTabs(a))}catch(e){console.error(e)}finally{this.loader.disable()}}async changeTabs(e,t){try{this.loader.enable();const e=await v();this.formNewAgreement.clientData=e,this.storeroomsRooms=document.querySelector(".account-storerooms-rooms"),this.storeroomsScheme=document.querySelector(".account-storerooms-scheme"),this.storeroomsRooms.classList.add("_none"),this.storeroomsScheme.classList.add("_none"),t.classList.contains("account-assets-storage")?(this.accessStorage.render({accountTabs:this.accountTabs,clientTotalData:e}),this.storeroomsRooms.classList.remove("_none")):t.classList.contains("account-storerooms")?(this.storerooms.renderAgreement({clientTotalData:e,formNewAgreement:this.formNewAgreement}),this.storeroomsScheme.classList.remove("_none")):t.classList.contains("account-change-password")?this.changePassword.renderForm():t.classList.contains("account-my-data")?this.myData.renderMyData({profile:this.profile,clientTotalData:e}):t.classList.contains("account-payment-methods")?this.paymentMethods.renderPaymentMethods({clientTotalData:e}):t.classList.contains("account-departures")&&this.departure.renderDeparture({clientTotalData:e})}catch(e){console.error(e)}finally{this.loader.disable()}}}},194:(e,t,o)=>{function s(e){return`<label class="payment-cards__card">\n                    <span>${e.bank?e.bank:""} ${e.rs?e.rs:""}</span>\n                    <p>Основной способ</p>\n                    <input type="radio" name="requisites" class="rent-room__payment_input-radio input-radio"\n                      id="card-payment-${e.requisites_id?`${e.requisites_id}-${(new Date).getTime()}`:""}" value="${e.requisites_id?e.requisites_id:""}" ${e.active?"checked":""}>\n                    <label for="card-payment-${e.requisites_id?`${e.requisites_id}-${(new Date).getTime()}`:""}" class="rent-room__payment_label label-radio"></label>\n                  </label>`}o.d(t,{O:()=>s})},220:(e,t,o)=>{o.d(t,{A:()=>a});var s=o(212),r=o(194);const a=class{constructor(e,t){e&&(this.wrapper=e,this.paymentCards=null,this.cards=[],this.cardsPayment=[],this.userType="f",this.requisites=[],this.cardId=null,this.options=Object.assign({isLinkCard:!0},t),this.init())}init(){this.paymentCards=this.wrapper.querySelector(".payment-cards"),this.paymentCards||(this.paymentCards=document.createElement("div"),this.paymentCards.classList.add("payment-cards"),this.wrapper.appendChild(this.paymentCards))}event(){if(this.paymentCards){const e=this.paymentCards.querySelectorAll('input[type="radio"]');e.length&&e.forEach((e=>{e.addEventListener("change",(()=>{this.cardId=e.value||null}))}))}}getNumberCard(e){if(!e||!this.cards.length)return;const[t]=this.cards.filter((t=>+t.card_id==+e));return this.cardId=e,t?t.pan:null}setCheckedInput(e=0){if(e>this.cardsPayment.length-1)return;const t=this.cardsPayment[e].querySelector('input[name="card_id"]');return t?(t.checked=!0,this.cardId=t.value||null,t):null}async render(e){try{e&&e.enable();const t=await s.hU.get("/_get_client_cards_list_");if(200!==t.status)return;const{cards:o}=t.data;return this.paymentCards.innerHTML="",o&&o.length?(o.forEach((e=>{var t;this.paymentCards.insertAdjacentHTML("beforeend",`<label class="payment-cards__card card-payment">\n                    <div class="payment-cards__card_img"><img src="img/icons/${function(e){if(!e)return;let t="";return t=/^4/.test(e)?"visa.png":/^5[0-5]/.test(e)?"mastercard.png":/^2([2-7]|6(3|7))/.test(e)?"mir.svg":"card.png",t}((t=e).pan)}" alt="Иконка"></div>\n                    <span>• • ${t.pan?t.pan.slice(-4):""}</span>\n                    <input type="radio" name="card_id" class="rent-room__payment_input-radio input-radio" id="card_id-${t.card_id?t.card_id:""}" value="${t.card_id?t.card_id:""}">\n                    <label for="card_id-${t.card_id?t.card_id:""}" class="rent-room__payment_label label-radio"></label>\n                  </label>`)})),this.cardsPayment=this.paymentCards.querySelectorAll(".card-payment"),this.cards=o,this.setCheckedInput(),this.event()):this.paymentCards.insertAdjacentHTML("afterbegin",'<span class="payment-cards__is-no-linked-card">У Вас нет привязанной карты</span>'),this.options.isLinkCard&&(this.paymentCards.insertAdjacentHTML("beforeend",'<label class="payment-cards__card card-payment">\n                    <img src="img/icons/card.png" alt="Иконка">\n                    <span>Привязать карту</span>\n                    <input type="radio" name="card_id" class="rent-room__payment_input-radio input-radio input-link-card" id="card_id-9фыв" value="null">\n                    <label for="card_id-9фыв" class="rent-room__payment_label label-radio"></label>\n                  </label>'),o.length||(this.paymentCards.querySelector(".input-link-card").checked=!0)),"u"===this.userType&&(this.paymentCards.innerHTML="",this.requisites.length&&this.requisites.forEach((e=>{this.paymentCards.insertAdjacentHTML("beforeend",(0,r.O)(e))}))),o}catch(e){console.error(e)}finally{e&&e.disable()}}}},241:(e,t,o)=>{o.d(t,{O7:()=>m,S1:()=>h,Sc:()=>l,gw:()=>d});var s=o(482),r=o(660),a=o(528),n=o(836);const i=(new Date).getFullYear();function c(){const e=new Date;return new Date(e.getFullYear()-18,e.getMonth(),e.getDate())}function l(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),o=e.querySelectorAll('input[name="card-payment"]');return o.length&&o.forEach((e=>{t.addField(e,[{rule:"required"}])})),t.addField(e.querySelector('input[name="privacy-policy"]'),[{rule:"required"}]),t}function d(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),o=e.querySelector('input[name="bik"]'),r=e.querySelector('input[name="inn"]'),a=e.querySelector('input[name="kpp"]'),n=e.querySelector('input[name="bank"]'),i=e.querySelector('input[name="rs"]'),c=e.querySelector('input[name="ks"]');return t.addField(e.querySelector('input[name="fullname"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(e.querySelector('input[name="address"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(o,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>9?o.value=e.slice(0,9):o.value=e.replace(/[^0-9]/g,""),9===o.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(r,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>10?r.value=e.slice(0,10):r.value=e.replace(/[^0-9]/g,""),10===r.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(a,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>9?a.value=e.slice(0,9):a.value=e.replace(/[^0-9]/g,""),9===a.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(n,[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё\s]+$/,errorMessage:"Неверный формат"}]).addField(i,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>20?i.value=e.slice(0,20):i.value=e.replace(/[^0-9]/g,""),20===i.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(c,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>20?c.value=e.slice(0,20):c.value=e.replace(/[^0-9]/g,""),20===c.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="privacy-policy"]'),[{rule:"required"}]),t}function m(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),o=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),l=e.querySelector('input[name="birthday"]'),d=e.querySelector('input[name="series"]'),m=e.querySelector('input[name="no"]'),h=e.querySelector('input[name="issue_date"]'),u=e.querySelector('input[name="subdivision"]');return r.default("9999").mask(d),r.default("999999").mask(m),r.default("99-99-9999").mask(h),r.default("99-99-9999").mask(l),r.default("999-999").mask(u),new n.A(l,{dateFormat:"dd-MM-yyyy",position:"bottom center",autoClose:!0,maxDate:c(),isMobile:o}),new n.A(h,{dateFormat:"dd-MM-yyyy",position:"bottom center",autoClose:!0,isMobile:o}),t.addField(e.querySelector('input[name="familyname"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="firstname"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="patronymic"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="birthday"]'),[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{let t=!1,o=+e.split("-")[2];return e.split("-")[1],e.split("-")[0],o<=i-18&&(t=!0),t},errorMessage:"Вам нет 18"}]).addField(e.querySelector('input[name="address"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(d,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=r.default.unmask(e,{mask:"9999"});return Boolean(Number(t)&&4===t.length)},errorMessage:"Неверный формат"}]).addField(m,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=r.default.unmask(e,{mask:"999999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(h,[{rule:"required",errorMessage:"Заполните поле"},{plugin:(0,a.A)((e=>({format:"dd-MM-yyyy",required:!0}))),errorMessage:"Неверный формат"}]).addField(u,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=r.default.unmask(e,{mask:"999-999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="issued_by"]'),[{rule:"required",errorMessage:"Заполните поле"}]),t}function h(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),o=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),i=e.querySelector('input[name="series"]'),c=e.querySelector('input[name="no"]'),l=e.querySelector('input[name="issue_date"]'),d=e.querySelector('input[name="subdivision"]');return r.default("9999").mask(i),r.default("999999").mask(c),r.default("99-99-9999").mask(l),r.default("999-999").mask(d),new n.A(l,{dateFormat:"dd-MM-yyyy",position:"bottom center",autoClose:!0,isMobile:o}),t.addField(i,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=r.default.unmask(e,{mask:"9999"});return Boolean(Number(t)&&4===t.length)},errorMessage:"Неверный формат"}]).addField(c,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=r.default.unmask(e,{mask:"999999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(l,[{rule:"required",errorMessage:"Заполните поле"},{plugin:(0,a.A)((e=>({required:!0,format:"dd-MM-yyyy"}))),errorMessage:"Неверный формат"}]).addField(d,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=r.default.unmask(e,{mask:"999-999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="issued_by"]'),[{rule:"required",errorMessage:"Заполните поле"}]),t}}}]);