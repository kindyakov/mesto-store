"use strict";(self.webpackChunkgulp2024=self.webpackChunkgulp2024||[]).push([[793,1,255],{194:(e,t,r)=>{function s(e){return`<label class="payment-cards__card">\n                    <span>${e.bank?e.bank:""} ${e.rs?e.rs:""}</span>\n                    <p>Основной способ</p>\n                    <input type="radio" name="requisites" class="rent-room__payment_input-radio input-radio"\n                      id="card-payment-${e.requisites_id?`${e.requisites_id}-${(new Date).getTime()}`:""}" value="${e.requisites_id?e.requisites_id:""}" ${e.active?"checked":""}>\n                    <label for="card-payment-${e.requisites_id?`${e.requisites_id}-${(new Date).getTime()}`:""}" class="rent-room__payment_label label-radio"></label>\n                  </label>`}r.d(t,{O:()=>s})},1:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var s=r(922),a=r(212),i=r(514),n=r(320);const o=class{constructor(e){this.options=Object.assign({wrapperSelector:".content-authorization",redirect:null,onAuth:()=>{}},e),this.wrapper=document.querySelector(this.options.wrapperSelector),this.urlParams=new URLSearchParams(window.location.search),this.form=document.querySelector(".form-authorization"),this.form&&(this.validator=(0,n.V)(this.form),this.loader=new s.a(this.wrapper),this.isAuth=!1,this.resData=null,this.username=this.urlParams.get("username"),this.username&&(this.form.querySelector('input[name="username"]').value=this.username.slice(1)),this.events())}events(){this.form&&this.form.addEventListener("submit",this.submit.bind(this))}submit(){if(!this.validator.isValid)return;const e=new FormData(this.form);e.set("username",e.get("username").replace(/[+() -]/g,"")),this.auth(e)}async auth(e){try{this.loader.enable();const t=await a.Ay.post("/_login_",e);if(200!==t.status)return;const{msg:r,msg_type:s,access_token:n,expiration_time:o}=this.resData=t.data;(0,i.G)(t.data),"success"===s&&(this.isAuth=!0,document.cookie=`token=Bearer ${n}; max-age=${o}; path=/`,this.options.onAuth(),this.options.redirect&&(document.location.pathname=this.options.redirect))}catch(e){console.error("Ошибка при регистрации",e.message)}finally{this.loader.disable()}}}},255:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var s=r(922),a=r(212),i=r(514),n=r(304),o=r(320);const l=class{constructor(e){this.options=Object.assign({wrapperSelector:".content-registration",redirect:null,onReg:()=>{}},e),this.wrapper=document.querySelector(this.options.wrapperSelector),this.formSendPhone=this.wrapper.querySelector(".form-send-phone"),this.formSendCode=this.wrapper.querySelector(".form-send-code"),this.formRegistration=this.wrapper.querySelector(".form-registration"),this.formSendPhone&&this.formSendCode&&this.formRegistration&&(this.validatorPhone=n.U.username(this.formSendPhone),this.validatorCode=n.U.code(this.formSendCode),this.validatorReg=(0,o.n)(this.formRegistration),this.loader=new s.a(this.wrapper),this.isReg=!1,this.resData=null,this.phone=null,this.code=null,this.timerStarted=!1,this.events())}events(){this.formSendPhone&&this.formSendPhone.addEventListener("submit",this.submitFormPhone.bind(this)),this.formSendCode&&this.formSendCode.addEventListener("submit",this.submitFormCode.bind(this)),this.formRegistration&&this.formRegistration.addEventListener("submit",this.submitRegistration.bind(this))}submitFormPhone(e){if(!this.validatorPhone.isValid||this.timerStarted)return;const t=new FormData(this.formSendPhone);this.phone=t.get("username").replace(/[+() -]/g,""),t.set("username",this.phone),this.getCode(t,e)}submitFormCode(){if(!this.validatorCode.isValid)return;const e=new FormData(this.formSendCode);e.append("phone",this.phone),this.sendCode(e)}submitRegistration(){if(!this.validatorReg.isValid)return;const e=new FormData(this.formRegistration);e.set("username",this.phone),e.delete("privacy_policy"),this.reg(e)}removeDisabled(e){e&&(e.classList.remove("_disabled"),e.elements.length&&Array.from(e.elements).forEach((e=>{e.removeAttribute("disabled")})))}startCountdown(e){if(this.timerStarted)return;const t=e.closest("form");this.timerStarted=!0,t.classList.add("_disabled");let r=120;const s=()=>{const t=Math.floor(r/60),s=r%60,a=t<10?`0${t}`:t,i=s<10?`0${s}`:s;e.querySelector("span").textContent=`${a}:${i}`};s();const a=setInterval((()=>{r-=1,s(),r<=0&&(clearInterval(a),this.timerStarted=!1,t.classList.remove("_disabled"),e.querySelector("span").textContent="Получить код")}),1e3)}async getCode(e,t){try{this.loader.enable();const r=await a.Ay.post("/_get_code_register_",e);if(200!==r.status)return;const{msg:s,msg_type:n}=r.data;(0,i.G)({msg:s,msg_type:n}),"success"===n&&(this.removeDisabled(this.formSendCode),this.startCountdown(t.submitter))}catch(e){console.error("Ошибка при получение кода",e.message)}finally{this.loader.disable()}}async sendCode(e){try{this.loader.enable();const t=await a.Ay.post("/_send_code_register_",e);if(200!==t.status)return;const{msg:r,msg_type:s}=t.data;(0,i.G)({msg:r,msg_type:s}),"success"===s&&this.removeDisabled(this.formRegistration)}catch(e){console.error("Ошибка при отправки кода:",e.message)}finally{this.loader.disable()}}async reg(e){try{this.loader.enable();const t=await a.Ay.post("/_register_",e);if(200!==t.status)return;const{msg:r,msg_type:s,access_token:n,expiration_time:o}=this.resData=t.data;(0,i.G)({msg:r,msg_type:s}),"success"===s&&(this.isReg=!0,document.cookie=`token=Bearer ${n}; max-age=${o}; path=/`,this.options.onReg(),this.sendApproveEmail(n),setTimeout((()=>{this.options.redirect&&(document.location.pathname=this.options.redirect)}),200))}catch(e){console.error("Ошибка при отправки кода:",e.message)}finally{this.loader.disable()}}async sendApproveEmail(e){try{a.hU.defaults.headers.Authorization=`Bearer ${e}`,await a.hU.post("/_send_approve_email_")}catch(e){console.error(e)}}}},320:(e,t,r)=>{r.d(t,{V:()=>i,n:()=>n});var s=r(482),a=r(660);function i(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=e.querySelector('input[name="username"]');return a.default("+7 (999) 999-99-99").mask(r),t.addField(e.querySelector('input[name="username"]'),[{rule:"required",errorMessage:"Введите телефон"},{validator:e=>{const t=a.default.unmask(e,{mask:"+7 (999) 999-99-99"});return Boolean(Number(t)&&10===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="password"]'),[{rule:"required",errorMessage:"Введите пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]),t}function n(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}});return t.addField(e.querySelector('input[name="email"]'),[{rule:"required",errorMessage:"Введите почту"},{rule:"email",errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="password"]'),[{rule:"required",errorMessage:"Введите пароль"},{rule:"minLength",value:6,errorMessage:"Пароль должен содержать минимум 6 символов"}]).addField(e.querySelector('input[name="repassword"]'),[{rule:"required",errorMessage:"Повторите пароль"},{validator:t=>t===e.querySelector('input[name="password"]').value,errorMessage:"Пароли не совпадают"}]).addField(e.querySelector('input[name="privacy_policy"]'),[{rule:"required"}]),t}},220:(e,t,r)=>{r.d(t,{A:()=>i});var s=r(212),a=r(194);const i=class{constructor(e,t){e&&(this.wrapper=e,this.paymentCards=null,this.cards=[],this.cardsPayment=[],this.userType="f",this.requisites=[],this.cardId=null,this.options=Object.assign({isLinkCard:!0},t),this.init())}init(){this.paymentCards=this.wrapper.querySelector(".payment-cards"),this.paymentCards||(this.paymentCards=document.createElement("div"),this.paymentCards.classList.add("payment-cards"),this.wrapper.appendChild(this.paymentCards))}event(){if(this.paymentCards){const e=this.paymentCards.querySelectorAll('input[type="radio"]');e.length&&e.forEach((e=>{e.addEventListener("change",(()=>{this.cardId=e.value||null}))}))}}getNumberCard(e){if(!e||!this.cards.length)return;const[t]=this.cards.filter((t=>+t.card_id==+e));return this.cardId=e,t?t.pan:null}setCheckedInput(e=0){if(e>this.cardsPayment.length-1)return;const t=this.cardsPayment[e].querySelector('input[name="card_id"]');return t?(t.checked=!0,this.cardId=t.value||null,t):null}async render(e){try{e&&e.enable();const t=await s.hU.get("/_get_client_cards_list_");if(200!==t.status)return;const{cards:r}=t.data;return this.paymentCards.innerHTML="",r&&r.length?(r.forEach((e=>{var t;this.paymentCards.insertAdjacentHTML("beforeend",`<label class="payment-cards__card card-payment">\n                    <div class="payment-cards__card_img"><img src="img/icons/${function(e){if(!e)return;let t="";return t=/^4/.test(e)?"visa.png":/^5[0-5]/.test(e)?"mastercard.png":/^2([2-7]|6(3|7))/.test(e)?"mir.svg":"card.png",t}((t=e).pan)}" alt="Иконка"></div>\n                    <span>• • ${t.pan?t.pan.slice(-4):""}</span>\n                    <input type="radio" name="card_id" class="rent-room__payment_input-radio input-radio" id="card_id-${t.card_id?t.card_id:""}" value="${t.card_id?t.card_id:""}">\n                    <label for="card_id-${t.card_id?t.card_id:""}" class="rent-room__payment_label label-radio"></label>\n                  </label>`)})),this.cardsPayment=this.paymentCards.querySelectorAll(".card-payment"),this.cards=r,this.setCheckedInput(),this.event()):this.paymentCards.insertAdjacentHTML("afterbegin",'<span class="payment-cards__is-no-linked-card">У Вас нет привязанной карты</span>'),this.options.isLinkCard&&(this.paymentCards.insertAdjacentHTML("beforeend",'<label class="payment-cards__card card-payment">\n                    <img src="img/icons/card.png" alt="Иконка">\n                    <span>Привязать карту</span>\n                    <input type="radio" name="card_id" class="rent-room__payment_input-radio input-radio input-link-card" id="card_id-9фыв" value="null">\n                    <label for="card_id-9фыв" class="rent-room__payment_label label-radio"></label>\n                  </label>'),r.length||(this.paymentCards.querySelector(".input-link-card").checked=!0)),"u"===this.userType&&(this.paymentCards.innerHTML="",this.requisites.length&&this.requisites.forEach((e=>{this.paymentCards.insertAdjacentHTML("beforeend",(0,a.O)(e))}))),r}catch(e){console.error(e)}finally{e&&e.disable()}}}},793:(e,t,r)=>{r.r(t),r.d(t,{default:()=>S});var s=r(836),a=r(325),i=r(922),n=r(508),o=r(212),l=r(1),d=r(255),u=r(241),m=r(47),c=r(417),h=r(943),p=r(13),g=r(514);async function y(e,t){try{t.enable();const r=await o.hU.post("/_form_new_agreement_",e,{headers:{Authorization:(0,p.Ri)("token"),"Content-Type":"multipart/form-data"}});if(200!==r.status)return;(0,g.G)(r.data),"success"===r.data.msg_type&&(document.location.pathname="/account.html")}catch(e){console.error(e)}finally{t.disable()}}var f=r(14),v=r(220);function b(e,t){const r=new Date(e);return r.setDate(e.getDate()+t),r}function _(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}const S=class{constructor(){this.rentRoom=document.querySelector(".rent-room"),this.rentRoom&&(this.urlParams=new URLSearchParams(window.location.search),this.roomIds=this.urlParams.get("ids")?JSON.parse(this.urlParams.get("ids")):[],this.roomIds.length&&(this.loader=new i.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed"}),this.authorizationTabs=new a.t("authorization-rent-room-tabs",{activeIndexTab:1}),this.authorization=new l.default({wrapperSelector:".authorization-rent-room"}),this.registration=new d.default({wrapperSelector:".authorization-rent-room"}),this.modalCheckingDetailsForm=new n.a(".modal-checking-details-form",{modalBtnClose:".btn-modal-close"}),this.modalCheckingInfoForm=new n.a(".modal-checking-info-form",{modalBtnClose:".btn-modal-close"}),this.cards=new v.A(this.rentRoom.querySelector(".form-payment-online")),this.isAuth=(0,o.T5)(),this.stepProgress=this.rentRoom.querySelectorAll(".step-progress"),this.scaleProgress=this.rentRoom.querySelector(".scale-progress"),this.steps=this.rentRoom.querySelectorAll(".rent-room-step"),this.activeIndexStep=0,this.scaleValues=[35,65,100],this.roomsSlider=new Swiper(".rooms-slider-rent-room",{spaceBetween:10,observeSlideChildren:!0,observer:!0,pagination:{el:".paging-slider-rent-rooms"},navigation:{nextEl:".btn-slider-rent-rooms-next",prevEl:".btn-slider-rent-rooms-prev"}}),this.rooms=this.rentRoom.querySelector(".rooms-rent-room"),this.formPaymentOnline=this.rentRoom.querySelector(".form-payment-online"),this.validatorPaymentOnline=(0,u.Sc)(this.formPaymentOnline),this.formPaymentInvoice=this.rentRoom.querySelector(".form-payment-invoice"),this.validatorPaymentInvoice=(0,u.gw)(this.formPaymentInvoice),this.formAgreementConclusion=this.rentRoom.querySelector(".form-agreement-conclusion"),this.validatorAgreementConclusion=(0,u.O7)(this.formAgreementConclusion),this.inputDate=this.rentRoom.querySelector(".input-date"),this.inputMonth=this.rentRoom.querySelector(".input-month"),this.month=this.urlParams.get("num_monthes")?JSON.parse(this.urlParams.get("num_monthes")):null,this.agrBegDate=this.urlParams.get("agrbegdate")?JSON.parse(this.urlParams.get("agrbegdate")):null,this.agreementData=null,this.user=null,this.formDataPaymentInvoice=null,this.payment=this.rentRoom.querySelector(".payment-rent-room"),this.paymentTabs=new a.t("payment-rent-room-tabs"),this.inputFile=this.rentRoom.querySelector(".input-file"),this.event=new Event("submit",{cancelable:!0}),this.resultPriceRooms=this.rentRoom.querySelectorAll(".result-price-room"),this.sumPriceCells=0,this.events(),this.init()))}events(){this.rentRoom&&this.roomIds.length&&(document.addEventListener("click",(e=>{if(e.target.closest(".tab-registration")&&(e.preventDefault(),this.authorizationTabs.switchTabs(this.authorizationTabs.tabs.querySelector(".btn-registration"))),e.target.closest(".tab-authorization")&&(e.preventDefault(),this.authorizationTabs.switchTabs(this.authorizationTabs.tabs.querySelector(".btn-authorization"))),e.target.closest(".item-month")){const t=e.target.closest(".item-month"),r=+t.getAttribute("data-month"),s=this.rentRoom.querySelector(".item-month._active");if(!r)return;const[a,i]=this.calculatePriceAndDepositByMonth(r,this.agreementData);this.inputMonth.classList.remove("just-validate-error-field"),this.inputMonth.value=r,this.month=r,s&&s.classList.remove("_active"),t&&t.classList.add("_active"),this.payment.scrollIntoView({behavior:"smooth",block:"start"}),this.changePriceSum(a,i)}if(e.target.closest(".button-send-form-payment-invoice")&&this.formDataPaymentInvoice&&async function(e,t){try{t.enable();const r=await o.hU.post("/_form_new_agreement_",e,{headers:{Authorization:(0,p.Ri)("token"),"Content-Type":"multipart/form-data"}});if(200!==r.status)return;return(0,g.G)(r.data),"success"!==r.data.msg_type?null:r.data}catch(e){console.error(e)}finally{t.disable()}}(this.formDataPaymentInvoice,this.loader).then((e=>{e&&(this.modalCheckingInfoForm.modal.querySelector(".btn-download-invoice")?.setAttribute("data-bill-id",e.bill_id),this.modalCheckingInfoForm.modal.querySelector(".content").innerHTML=function(e){return`<b style="align-items: center;">Счет ${e.bill_id?e.bill_id:""} сформирован и отправлен вам на почту ${e.email?e.email:""}</b>`}({...e,email:this.user.email}),this.modalCheckingInfoForm.open())})),e.target.closest(".btn-download-invoice")){const t=e.target.closest(".btn-download-invoice").getAttribute("data-bill-id");t&&(0,f.iK)(t,this.loader,"/account.html")}})),this.inputFile&&this.inputFile.addEventListener("change",(e=>{e.target.files.length?(e.target.parentElement.classList.remove("_error"),this.inputFile.parentElement.querySelector("b").innerHTML=e.target.files[0].name):(e.target.parentElement.classList.add("_error"),this.inputFile.parentElement.querySelector("b").innerHTML="")})),this.inputDate&&(this.inputDate.value=(0,h.p)("DD-MM-YYYY"),this.agrBegDatePicker=new s.A(this.inputDate,{dateFormat:"dd-MM-yyyy",position:"bottom center",startDate:new Date,autoClose:!0,minDate:_(b(new Date,0)),maxDate:_(b(new Date,30)),isMobile:/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),onSelect:({date:e,formattedDate:t,datepicker:r})=>{r.$el.classList.remove("just-validate-error-field"),this.agrBegDate=(0,h.p)("YYYY-MM-DD",e)}}),this.agrBegDate||(this.agrBegDate=(0,h.p)("YYYY-MM-DD"))),this.inputMonth&&this.inputMonth.addEventListener("input",(e=>{const t=this.rentRoom.querySelector(".item-month._active"),r=this.rentRoom.querySelector(`.item-month[data-month="${this.inputMonth.value}"]`),s=this.inputMonth.value;this.month=s,0==+s?this.inputMonth.value="":this.inputMonth.value.length>2?this.inputMonth.value=s.slice(0,2):this.inputMonth.value=s.replace(/[^0-9]/g,"");const[a,i]=this.calculatePriceAndDepositByMonth(s,this.agreementData);(1!=+s.slice(0,1)&&1===this.inputMonth.value.length||this.inputMonth.value.length>1)&&(e.target.blur(),this.payment.scrollIntoView({behavior:"smooth",block:"start"})),this.inputMonth.classList.remove("just-validate-error-field"),t&&t.classList.remove("_active"),r&&r.classList.add("_active"),this.changePriceSum(a,i)})),this.formPaymentOnline&&this.formPaymentOnline.addEventListener("submit",this.submitPaymentOnline.bind(this)),this.formPaymentInvoice&&this.formPaymentInvoice.addEventListener("submit",this.submitPaymentInvoice.bind(this)),this.formAgreementConclusion&&this.formAgreementConclusion.addEventListener("submit",this.submitAgreementConclusion.bind(this)),this.authorization.options.onAuth=()=>{o.hU.defaults.headers.Authorization=(0,p.Ri)("token"),ym(97074608,"reachGoal","auth"),this.swapStep(this.activeIndexStep=1),this.getUser()},this.registration.options.onReg=()=>{o.hU.defaults.headers.Authorization=(0,p.Ri)("token"),ym(97074608,"reachGoal","register"),this.swapStep(this.activeIndexStep=1),this.getUser()})}init(){this.rentRoom&&this.roomIds.length&&(this.isAuth&&(this.activeIndexStep=this.urlParams.get("step")?+this.urlParams.get("step"):1,this.swapStep(this.activeIndexStep),this.getUser(),2==this.activeIndexStep&&ym(97074608,"reachGoal","order")),this.roomIds.length&&this.renderRooms((0,c.D)({room_ids:JSON.stringify(this.roomIds)})))}swapStep(e){if(!this.steps.length||!this.stepProgress.length)return;const t=this.rentRoom.querySelector(".step-progress._active"),r=this.rentRoom.querySelector(".rent-room-step._step-active");t&&t.classList.remove("_active"),this.stepProgress[e].classList.add("_active"),r&&r.classList.remove("_step-active"),this.steps[e].classList.add("_step-active"),this.scaleProgress&&(this.scaleProgress.style.width=this.scaleValues[e]+"%"),1==e?(this.cards.render(this.loader),this.payment.classList.remove("_none")):this.payment.classList.add("_none")}submitPaymentOnline(e){if(!this.agrBegDate)return this.inputDate.classList.add("just-validate-error-field"),void this.scrollToErrInput(this.inputDate);if(this.inputDate.classList.remove("just-validate-error-field"),!this.month)return this.inputMonth.classList.add("just-validate-error-field"),void this.scrollToErrInput(this.inputMonth);if(this.inputMonth.classList.remove("just-validate-error-field"),!this.validatorPaymentOnline.isValid)return;const t=new FormData(e.target);t.delete("card-number"),t.delete("exp-date"),t.delete("cvc"),t.delete("privacy-policy"),t.set("room_ids",JSON.stringify(this.roomIds)),t.set("user_type","f"),t.set("num_monthes",this.month),t.set("agrbegdate",this.agrBegDate),t.set("autopay",t.get("auto-payments")?1:0),t.set("return_url",location.href+`&step=2&num_monthes=${this.month}&agrbegdate=${this.agrBegDate}`),t.delete("auto-payments"),(0,f.KD)(t,this.loader)}submitPaymentInvoice(e){if(e.preventDefault(),!this.agrBegDate)return this.inputDate.classList.add("just-validate-error-field"),void this.scrollToErrInput(this.inputDate);if(this.inputDate.classList.remove("just-validate-error-field"),!this.month)return this.inputMonth.classList.add("just-validate-error-field"),void this.scrollToErrInput(this.inputMonth);if(this.inputMonth.classList.remove("just-validate-error-field"),this.validatorPaymentInvoice.isValid){const t=new FormData(e.target);let r={};t.set("room_ids",JSON.stringify(this.roomIds)),t.set("num_monthes",this.month),t.set("agrbegdate",this.agrBegDate),t.set("user_type","u"),t.set("rent_or_test","rent"),t.delete("privacy-policy"),Array.from(t).forEach((e=>r[e[0]]=e[1])),r.price=this.sumPriceCells,r.email=this.user.email,r.fio=`${this.user.familyname} ${this.user.firstname} ${this.user.patronymic}`,this.formDataPaymentInvoice=t,this.modalCheckingDetailsForm.modal.querySelector(".content").innerHTML=function(e){return`\n  <b>Проверка и подтверждение выписки счета</b>\n  <span>Организация: "${e.fullname?e.fullname:""}"</span>\n  <span>ИНН: ${e.inn?e.inn:""}</span>\n  <span>Сумма: ${e.price?(0,m.F)(e.price):""}</span>\n  <span>Email: ${e.email?e.email:""}</span>\n  <span>Адрес: ${e.address?e.address:""}</span>`}(r),this.modalCheckingDetailsForm.open()}else this.scrollToErrInput(this.formPaymentInvoice.querySelector(".just-validate-error-field"))}submitAgreementConclusion(e){if(e.preventDefault(),!this.user.approved){if(!this.inputFile.files.length)return void this.inputFile.parentElement.classList.add("_error");this.inputFile.parentElement.classList.remove("_error")}if(this.validatorAgreementConclusion.isValid){const e=new FormData(this.formAgreementConclusion);e.set("room_ids",JSON.stringify(this.roomIds)),e.set("user_type","f"),e.set("num_monthes",this.month),e.set("agrbegdate",this.agrBegDate),e.set("rent_or_test","rent"),y(e,this.loader)}else this.scrollToErrInput(this.formAgreementConclusion.querySelector(".input.just-validate-error-field"))}async renderRooms(e){try{this.loader.enable();const t=await o.Ay.get(`/_form_new_agreement_get_${e}`);if(200!==t.status)return;this.agreementData=t.data;const{rooms:r,amount_1m:s,deposit_1m:a}=t.data,i=this.rentRoom.querySelector(".bottom-rooms-slider-rent-room"),n=this.rentRoom.querySelectorAll("[data-amount]");if(!r||!r?.length)return;this.rooms.innerHTML="",this.sumPriceCells=s,r.forEach((e=>{var t;this.rooms.insertAdjacentHTML("beforeend",`\n  <div class="rent-room__room swiper-slide">\n    <div class="rent-room__room_img">\n      <img src="img/rooms.jpg" alt="Картинка">\n    </div>\n    <div class="rent-room__room_content">\n      <div class="rent-room__room_top">\n        <h4 class="rent-room__room_title">${(t=e).room_id?"Кладовка "+t.room_id:""}</h4>\n        <span class="rent-room__room_price">${t.price?"от "+(0,m.F)(t.price)+"/мес.":""}</span>\n      </div>\n    <div class="rent-room__room_features"><span>Электромеханический замок</span></div>\n      <ul class="rent-room__room_characteristic">\n        <li>\n          <span>Площадь</span>\n          <b>${t.area?t.area+" м<sup>2</sup>":""}</b>\n        </li>\n        <li>\n          <span>Объём</span>\n          <b>${t.volume?t.volume+" м<sup>3</sup>":""}</b>\n        </li>\n        <li>\n          <span>Размер кладовки (ДхШхВ)</span>\n          <b>${t.dimensions?t.dimensions:""}</b>\n        </li>\n      </ul>\n    </div>\n  </div>`)})),n.length&&n.forEach((e=>{const r=e.closest(".item-month"),s=t.data[e.getAttribute("data-amount")];r.setAttribute("data-price",s),e.textContent=`от ${(0,m.F)(s)}`})),i&&1===r.length&&i.classList.add("_none"),this.changePriceSum(this.sumPriceCells,a)}catch(e){console.error(e)}finally{this.loader.disable()}}async getUser(){try{this.loader.enable();const e=await o.Ay.get("/_profile_",{headers:{Authorization:(0,p.Ri)("token")}});if(200!==e.status)return;const t=this.rentRoom.querySelectorAll(".input-agreement-conclusion"),r=this.rentRoom.querySelectorAll(".rent-room__payment_input"),{user:s}=e.data;if(this.user=s,t.length&&t.forEach((e=>{e.value=s[e.name]?s[e.name]:""})),r.length&&r.forEach((e=>{e.value=s[e.name]?s[e.name]:""})),"f"===s.user_type?(document.querySelector(".rent-room__payment_tabs").classList.add("_none"),this.paymentTabs.switchTabs(document.querySelector('[data-tabs-btn="payment-rent-room-tabs-0"]'))):"u"===s.user_type?(document.querySelector(".rent-room__payment_tabs").classList.add("_none"),this.paymentTabs.switchTabs(document.querySelector('[data-tabs-btn="payment-rent-room-tabs-1"]'))):document.querySelector(".rent-room__payment_tabs").classList.remove("_none"),2==this.activeIndexStep&&this.user.approved){const e=new FormData;e.set("room_ids",JSON.stringify(this.roomIds)),e.set("user_type","f"),e.set("num_monthes",this.month),y(e,this.loader)}}catch(e){console.error(e)}finally{this.loader.disable()}}scrollToErrInput(e){e&&("privacy-policy"===e.name?this.formPaymentInvoice.querySelector(".privacy-policy").scrollIntoView({behavior:"smooth",block:"center"}):e.scrollIntoView({behavior:"smooth",block:"center"}))}calculatePriceAndDepositByMonth(e,t){let r=0,s=0;return e<6?(r=t.amount_1m,s=t.deposit_1m):e>=6&&e<=10?(r=t.amount_6m,s=t.deposit_6m):e>10&&(r=t.amount_11m,s=t.deposit_11m),[r,s]}changePriceSum(e,t){this.rentRoom.querySelector(".info-payment-rent-room").innerHTML=`<span>Арендный платеж за первый месяц</span><b style="text-align: right;">${(0,m.F)(+e)}</b>\n                       <span>Депозит (вернется после окончания аренды)</span><b style="text-align: right;">${(0,m.F)(+t)}</b>`,this.resultPriceRooms.length&&this.resultPriceRooms.forEach(((r,s)=>{r.textContent=(0,m.F)(+e+ +t)+"/мес"}))}}},241:(e,t,r)=>{r.d(t,{O7:()=>m,S1:()=>c,Sc:()=>d,gw:()=>u});var s=r(482),a=r(660),i=r(528),n=r(836);const o=(new Date).getFullYear();function l(){const e=new Date;return new Date(e.getFullYear()-18,e.getMonth(),e.getDate())}function d(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=e.querySelectorAll('input[name="card-payment"]');return r.length&&r.forEach((e=>{t.addField(e,[{rule:"required"}])})),t.addField(e.querySelector('input[name="privacy-policy"]'),[{rule:"required"}]),t}function u(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=e.querySelector('input[name="bik"]'),a=e.querySelector('input[name="inn"]'),i=e.querySelector('input[name="kpp"]'),n=e.querySelector('input[name="bank"]'),o=e.querySelector('input[name="rs"]'),l=e.querySelector('input[name="ks"]');return t.addField(e.querySelector('input[name="fullname"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(e.querySelector('input[name="address"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(r,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>9?r.value=e.slice(0,9):r.value=e.replace(/[^0-9]/g,""),9===r.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(a,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>10?a.value=e.slice(0,10):a.value=e.replace(/[^0-9]/g,""),10===a.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(i,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>9?i.value=e.slice(0,9):i.value=e.replace(/[^0-9]/g,""),9===i.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(n,[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё\s]+$/,errorMessage:"Неверный формат"}]).addField(o,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>20?o.value=e.slice(0,20):o.value=e.replace(/[^0-9]/g,""),20===o.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(l,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>(e.length>20?l.value=e.slice(0,20):l.value=e.replace(/[^0-9]/g,""),20===l.value.replace(/[^0-9]/g,"").length),errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="privacy-policy"]'),[{rule:"required"}]),t}function m(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),d=e.querySelector('input[name="birthday"]'),u=e.querySelector('input[name="series"]'),m=e.querySelector('input[name="no"]'),c=e.querySelector('input[name="issue_date"]'),h=e.querySelector('input[name="subdivision"]');return a.default("9999").mask(u),a.default("999999").mask(m),a.default("99-99-9999").mask(c),a.default("99-99-9999").mask(d),a.default("999-999").mask(h),new n.A(d,{dateFormat:"dd-MM-yyyy",position:"bottom center",autoClose:!0,maxDate:l(),isMobile:r}),new n.A(c,{dateFormat:"dd-MM-yyyy",position:"bottom center",autoClose:!0,isMobile:r}),t.addField(e.querySelector('input[name="familyname"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="firstname"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="patronymic"]'),[{rule:"required",errorMessage:"Заполните поле"},{rule:"customRegexp",value:/^[А-ЯЁа-яё]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="birthday"]'),[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{let t=!1,r=+e.split("-")[2];return e.split("-")[1],e.split("-")[0],r<=o-18&&(t=!0),t},errorMessage:"Вам нет 18"}]).addField(e.querySelector('input[name="address"]'),[{rule:"required",errorMessage:"Заполните поле"}]).addField(u,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=a.default.unmask(e,{mask:"9999"});return Boolean(Number(t)&&4===t.length)},errorMessage:"Неверный формат"}]).addField(m,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=a.default.unmask(e,{mask:"999999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(c,[{rule:"required",errorMessage:"Заполните поле"},{plugin:(0,i.A)((e=>({format:"dd-MM-yyyy",required:!0}))),errorMessage:"Неверный формат"}]).addField(h,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=a.default.unmask(e,{mask:"999-999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="issued_by"]'),[{rule:"required",errorMessage:"Заполните поле"}]),t}function c(e){if(!e)return;const t=new s.Ay(e,{errorLabelStyle:{color:"#FF0505"}}),r=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),o=e.querySelector('input[name="series"]'),l=e.querySelector('input[name="no"]'),d=e.querySelector('input[name="issue_date"]'),u=e.querySelector('input[name="subdivision"]');return a.default("9999").mask(o),a.default("999999").mask(l),a.default("99-99-9999").mask(d),a.default("999-999").mask(u),new n.A(d,{dateFormat:"dd-MM-yyyy",position:"bottom center",autoClose:!0,isMobile:r}),t.addField(o,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=a.default.unmask(e,{mask:"9999"});return Boolean(Number(t)&&4===t.length)},errorMessage:"Неверный формат"}]).addField(l,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=a.default.unmask(e,{mask:"999999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(d,[{rule:"required",errorMessage:"Заполните поле"},{plugin:(0,i.A)((e=>({required:!0,format:"dd-MM-yyyy"}))),errorMessage:"Неверный формат"}]).addField(u,[{rule:"required",errorMessage:"Заполните поле"},{validator:e=>{const t=a.default.unmask(e,{mask:"999-999"});return Boolean(Number(t)&&6===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="issued_by"]'),[{rule:"required",errorMessage:"Заполните поле"}]),t}}}]);