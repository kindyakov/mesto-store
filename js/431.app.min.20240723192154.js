"use strict";(self.webpackChunkgulp2024=self.webpackChunkgulp2024||[]).push([[431],{431:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var o=s(47);function r(e,t=!1){return`\n  <div class="warehouse__rooms_room room-warehouse ${t?"_selected":""}" data-room-id="${e.room_id&&e.room_id}" data-warehouse-id="${e.warehouse_id&&e.warehouse_id}">\n    <div class="warehouse__rooms_room-content">\n      <span class="warehouse__rooms_room-num">${e.room_id?"№"+e.room_id:""}</span>\n      <span class="warehouse__rooms_room-area">${e.volume?e.volume+" м<sup>3</sup>":""}</span>\n      <div class="warehouse__rooms_room-block dimensions">\n        <span>размер кладовки</span>\n        <b>${e.dimensions?e.dimensions+" м":""}</b>\n      </div>\n      <div class="warehouse__rooms_room-block floor">\n        <span>ярус</span>\n        <b>${e.floor?e.floor:""}</b>\n      </div>\n    </div>\n    <a href="../room.html?id=${e.room_id}" class="warehouse__rooms_room-link button link-rent-storage-room">\n      <span>${e.price_11m?"от "+(0,o.F)(e.price_11m):""}</span>\n    </a>\n  </div>`}var a=s(514);const i=(e,t)=>{const s=e.value.replace(/[^0-9]/g,"");return e.value.length>t.toString().length?e.value=e.value.slice(0,t.toString().length):Number(s)>Number(t)?e.value=t:e.value=s,s.length<=t.toString().length},n=(e,t)=>{const s=e.value&&e.value.replace(/[^0-9.]/g,"");if(!s)return!1;const o=s.indexOf(".");if(-1!==o){const t=s.slice(0,o+2);return e.value=t.replace(/,/g,"."),!0}return Number(s)>Number(t)?e.value=t:e.value=s,!0};function l(e){return Number(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}class h{constructor(e,t){this.options=Object.assign({onChange:()=>{},onInit:()=>{},selectorInput:""},t),this.ranges=document.querySelectorAll(e),this.inputs=document.querySelectorAll(this.options.selectorInput),this.timerRange=null,this.slidersFormat={volume:{to:e=>`${e.toFixed(0)}м<sup>3</sup>`,from:e=>parseFloat(e)},duration:{to:e=>`${e.toFixed(0)}м`,from:e=>parseFloat(e)}},this.rangeStartData={volume_start:1,volume_end:17,price_start:1,price_end:22e3},this.rangeData={...this.rangeStartData,volume_end:16},this.areaDifference=this.rangeStartData.volume_end-this.rangeData.volume_end,this.rangeInputsValidate={volume_start:e=>n(e,this.rangeStartData.volume_end-this.areaDifference),volume_end:e=>n(e,this.rangeStartData.volume_end-this.areaDifference),price_start:e=>i(e,this.rangeStartData.price_end),price_end:e=>i(e,this.rangeStartData.price_end)},this.init()}init(){if(!this.ranges.length)return console.error("range нет");this.sliders={},this.ranges.forEach((e=>{const t=e.getAttribute("data-type-range"),s=noUiSlider.create(e,{start:[this.rangeStartData[`${t}_start`],this.rangeStartData[`${t}_end`]],connect:!0,step:1,range:{min:this.rangeStartData[`${t}_start`],max:this.rangeStartData[`${t}_end`]},margin:1,pips:{mode:"count",values:"volume"===t?this.rangeStartData[`${t}_end`]:2,density:100,stepped:!0}});if("volume"===t){const t=e.querySelectorAll(".noUi-value");t.length&&t.forEach(((e,s)=>{e.innerHTML=0===s?"1<span>м³</span>":1===s?"1.5<span>м³</span>":+e.textContent-this.areaDifference+"<span>м³</span>",t.length-1===s&&(e.classList.add("_last"),e.innerHTML=e.innerHTML+"+")}))}else if("price"===t){const t=e.querySelectorAll(".noUi-value");t.length&&t.forEach(((e,s)=>{e.textContent=l(e.textContent),t.length-1===s&&(e.classList.add("_last"),e.innerHTML=e.innerHTML+"+")}))}this.sliders[t]=s,this.createHtmlTooltip(e)}));for(let e in this.sliders)this.sliders.hasOwnProperty(e)&&(this.sliders[e].on("slide",((e,t,s,o,r,a)=>this.rangeSlide({values:e,handle:t,unencoded:s,tap:o,positions:r,noUiSlider:a}))),this.sliders[e].on("change",((e,t,s)=>this.rangeChange(e,t,s))));this.handleInput(),this.options.onInit(this.sliders)}rangeSlide({values:e,handle:t,unencoded:s,noUiSlider:o}){const r=o.target.getAttribute("data-type-range"),a=document.querySelectorAll(`${this.options.selectorInput}[data-type-range="${r}"]`),i=a[t].closest("label"),n=Number(s[t].toFixed(0)),h=a[t].parentElement.querySelector(".type");if(i.style.borderColor="#000",a[t].classList.add("_focus"),"volume"===r)if(1===n||2==n){const e=2==n?1.5:1;this.rangeData[a[t].name]=e,a[t].value=e,h.textContent="м³"}else this.rangeData[a[t].name]=n-this.areaDifference,a[t].value=n-this.areaDifference,h.textContent="м³";else"price"===r?(a[t].value=l(n),this.rangeData[a[t].name]=n):(this.rangeData[a[t].name]=n,a[t].value=n);clearTimeout(this.timerRange),this.timerRange=setTimeout((()=>{a[t].classList.remove("_focus")}),500)}rangeChange(e,t,s){16===this.rangeData.volume_end&&(this.rangeData.volume_end=100),this.rangeData.price_end===this.rangeStartData.price_end&&(this.rangeData.price_end=1e5),this.options.onChange(this.rangeData,e,t,s)}handleInput(){this.inputs.length&&this.inputs.forEach((e=>{e.addEventListener("input",(()=>{const t=e.closest("label"),s=e.getAttribute("data-type-range"),o=e.name.split("_").at(-1),r="start"===o?0:1,i=this.sliders[s];let n=function(e){return e.map((e=>parseFloat(e.replace(/\s/g,"").replace(/ /g,""))))}(i.get());this.rangeInputsValidate[e.name](e),this.rangeData[e.name]=Number(e.value),clearTimeout(this.timerRange),this.timerRange=setTimeout((()=>{const[l]=Array.from(this.inputs).filter((t=>s===t.getAttribute("data-type-range")&&t!==e));if("start"===o){if(+e.value>=+l.value.replace(/\s/g,""))return t.style.borderColor="red",void(0,a.G)({msg:"Начальное значение не может быть больше или равно конечному",msg_type:"warning"})}else if(+e.value<=+l.value.replace(/\s/g,""))return t.style.borderColor="red",void(0,a.G)({msg:"Конечное значение не может быть меньше или равно начальному",msg_type:"warning"});t.style.borderColor="#000","volume"===s?1==+e.value?n[r]=1:1.5==+e.value?n[r]=2:n[r]=+e.value+this.areaDifference:n[r]=+e.value,i.set(n),this.rangeChange()}),500)}))}))}updateInputValue(e,t){const s=document.querySelectorAll(`${this.options.selectorInput}[data-type-range="${e}"]`);t[0]||(t[0]=this.rangeStartData.volume_start),t[1]||(t[1]=this.rangeData.volume_end);const[o,r]=t;s.length&&s.forEach(((s,a)=>{const i=s.parentElement.querySelector(".type"),n=Number((+t[a]).toFixed(0));"volume"===e?1==+o&&1.5==+r||1.5==+r?(s.value=1==n?1:1.5,i.textContent="м³"):(s.value=n||"",i.textContent="м³"):s.value=n||""}))}createHtmlTooltip(e){const t=e.querySelectorAll(".noUi-handle");t&&t.length&&t.forEach((e=>{e.insertAdjacentHTML("beforeend",'\n      <div class="range-tooltip">\n        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">\n          <circle cx="14" cy="14" r="12" fill="#F5F5F5" />\n          <path d="M14 28C21.7 28 28 21.7 28 14C28 6.3 21.7 0 14 0C6.3 0 0 6.3 0 14C0 21.7 6.3 28 14 28ZM14 25.2C9.66 25.2 5.74 22.68 3.92 18.9L10.64 16.52C11.48 17.64 12.74 18.2 14 18.2C15.26 18.2 16.52 17.64 17.22 16.66L24.08 18.9C22.26 22.68 18.34 25.2 14 25.2ZM15.4 2.94C20.86 3.64 25.2 8.4 25.2 14C25.2 14.84 25.06 15.54 24.92 16.38L18.2 14C18.2 12.18 17.08 10.64 15.4 10.08L15.4 2.94ZM14 12.6C14.84 12.6 15.4 13.16 15.4 14C15.4 14.84 14.84 15.4 14 15.4C13.16 15.4 12.6 14.84 12.6 14C12.6 13.16 13.16 12.6 14 12.6ZM12.6 2.94L12.6 10.08C10.92 10.64 9.8 12.18 9.8 14L3.08 16.38C2.94 15.54 2.8 14.84 2.8 14C2.8 8.26 7.14 3.64 12.6 2.94Z" fill="#2D3A3D" />\n        </svg>\n      </div>')}))}setSlider(e,t){if("volume"===e){let[s,o]=t,r=!0;s||(r=!1,s=this.rangeStartData.volume_start),o||(o=this.rangeData.volume_end),1==+s&&1.5==+o?(this.sliders[e].set([1,2]),this.rangeData.volume_start=+s,this.rangeData.volume_end=+o):(this.sliders[e].set([r?+s+this.areaDifference:+s,+o+this.areaDifference]),this.rangeData.volume_start=+s,this.rangeData.volume_end=+o)}else this.sliders[e].set(t)}}var u=s(325),c=s(922),m=s(212),d=s(417),_=s(700),g=s(543),p=s(337);const v=class{constructor(){this.warehouse=document.querySelector(".warehouse"),this.warehouse&&(this.urlParams=new URLSearchParams(window.location.search),this.warehouseId=+this.warehouse.getAttribute("data-warehouse-id"),this.depth=location.pathname.split("/").filter((e=>e)).length-1,this.pathPrefix=this.depth>0?"../".repeat(this.depth):"",this.warehouseId&&(this.titlePage=document.querySelector("title"),this.slider=new Swiper(".slider-warehouse",{slidesPerView:1,observeSlideChildren:!0,observer:!0,loop:!0,navigation:{nextEl:".warehouse__slider-btn.btn-slider-next",prevEl:".warehouse__slider-btn.btn-slider-prev"}}),this.warehouseElements=this.warehouse.querySelectorAll("[data-warehouse-key]"),this.tabsScheme=new u.t("tabs-warehouse",{btnSelector:".tabs-btn-schemes",contentSelector:".tabs-content-schemes"}),this.range=new h(".range-filter-warehouse",{selectorInput:".input-filter-warehouse"}),this.loader=new c.a(document.querySelector(".main"),{isHidden:!1,customSelector:"custom-loader",position:"fixed"}),this.schemeOne=this.warehouse.querySelector(".scheme-1"),this.schemeTwo=this.warehouse.querySelector(".scheme-2"),this.schemeActive=this.schemeOne,this.contentRoomsWarehouse=this.warehouse.querySelector(".content-rooms-warehouse"),this.infoResultWarehouse=this.warehouse.querySelector(".info-result-warehouse"),this.linkResultWarehouse=this.warehouse.querySelector(".link-result-warehouse"),this.buttonResultWarehouse=this.warehouse.querySelector(".button-result-warehouse"),this.rooms=[],this.resultRoomsData={volume:0,price_11m:0,ids:[],count_rooms:0,rooms:[]},this.pathContent=document.querySelector(".path-content"),this.init()))}init(){const e=+this.urlParams.get("volume_start"),t=+this.urlParams.get("volume_end");this.range.setSlider("volume",[e,t]),this.range.updateInputValue("volume",[e,t]),this.reqData={...this.range.rangeData,floor:1},this.events(),this.process()}events(){this.tabsScheme.options.onChange=(e,t,s,o)=>{s.classList.contains("content-schemes-one")?(this.schemeActive=this.schemeOne,this.reqData.floor=1):s.classList.contains("content-schemes-two")&&(this.schemeActive=this.schemeTwo,this.reqData.floor=2),this.process((0,d.D)(this.reqData))},this.range.options.onChange=e=>{this.reqData={floor:this.reqData.floor,warehouse_id:this.reqData.warehouse_id,...e},this.process((0,d.D)(this.reqData))},this.warehouse.addEventListener("click",(e=>{if((0,p.N)(),e.target.closest(".warehouse__svg-cell")&&e.preventDefault(),e.target.closest(".warehouse__svg-cell.free")&&(e.preventDefault(),this.rooms.length&&this.handlerClickSvgCell(e,this.rooms)),e.target.closest(".link-result-warehouse")&&!this.resultRoomsData.ids.length&&e.preventDefault(),e.target.closest(".warehouse__filter_tab")){const t=e.target.closest(".warehouse__filter_tab"),s=t.getAttribute("data-type-range"),o=t.getAttribute("data-va")?.split(",");if(!s||!o?.length)return;this.range.setSlider(s,o),this.range.updateInputValue(s,o),16===this.range.rangeData.volume_end&&(this.range.rangeData.volume_end=100),this.range.rangeData.price_end===this.range.rangeStartData.price_end&&(this.range.rangeData.price_end=1e5),this.reqData={floor:this.reqData.floor,warehouse_id:this.reqData.warehouse_id,...this.range.rangeData},10==+o[0]&&(this.reqData.area_start=10,delete this.reqData.area_end),this.process((0,d.D)(this.reqData))}e.target.closest(".room-warehouse")&&!e.target.closest(".warehouse__rooms_room-link")&&this.rooms.length&&this.handlerClickSvgCell(e,this.rooms)}))}renderWarehouses(e){if(!e.length||!this.warehouse||!this.warehouseId)return;const[t]=e.filter((e=>+e.warehouse_id===this.warehouseId));this.reqData.warehouse_id=t.warehouse_id,this.warehouseElements.length&&this.warehouseElements.forEach((e=>{const s=e.getAttribute("data-warehouse-key");e.textContent=t[s]})),this.pathContent&&!this.pathContent.closest(".path").classList.contains("not")&&(this.pathContent.innerHTML=`\n              <a href="${this.pathPrefix}index.html" class="path__link hover-link">Главная</a>\n              <span class="path__sep">/</span>\n              <span class="path__link">${t.warehouse_name}</span>`)}renderScheme(e,t){this.schemeActive.querySelectorAll(".warehouse__svg-cell")?.forEach((e=>{e.classList.remove("free","busy","disabled","_selected","select-size")})),e.length&&e.forEach((e=>{const t=this.schemeActive.querySelector(`.warehouse__svg-cell[data-cell-num="${e.room_id}"]`);t&&(t.setAttribute("data-rented",e.rented),t.setAttribute("data-room-id",e.room_id),t.classList.add("select-size"))})),t.length&&t.forEach((e=>{const t=this.schemeActive.querySelector(`.warehouse__svg-cell[data-cell-num="${e.room_id}"]`);t&&(t.setAttribute("data-rented",e.rented),t.setAttribute("data-room-id",e.room_id),t.classList.add(0==+e.rented?"free":"disabled"))}))}renderRooms(e){e.length?(this.contentRoomsWarehouse.innerHTML="",e.length&&e.forEach((e=>{this.contentRoomsWarehouse.insertAdjacentHTML("beforeend",r(e))})),(0,g.B)(".warehouse__rooms_room-num",{breakpointsNone:576}),(0,g.B)(".warehouse__rooms_room-area",{breakpoints:[1215,576]}),(0,g.B)(".warehouse__rooms_room-block.dimensions",{breakpoints:[1215,576]}),(0,g.B)(".warehouse__rooms_room-link",{breakpoints:[576,370]})):this.contentRoomsWarehouse.innerHTML='<div class="not-filtered-rooms"><span>Нет свободных ячеек по заданным параметрам</span></div>'}async process(e=(0,d.D)(this.reqData)){try{this.loader.enable();const t=await m.Ay.get(`/_update_floor_for_client_${e}`);if(200!==t.status)return;const{filtered_rooms:s,rooms:o}=t.data;if(!o)return;this.rooms=o,this.renderScheme(s,o),this.renderRooms(s),this.resultRoomsData.rooms.length&&this.resultRoomsData.rooms.forEach((e=>{const t=this.warehouse.querySelector(`.warehouse__svg-cell[data-room-id="${e.room_id}"]`),s=this.warehouse.querySelector(`.room-warehouse[data-room-id="${e.room_id}"]`);t&&t.classList.add("_selected"),s&&(s.remove(),this.contentRoomsWarehouse.insertAdjacentHTML("afterbegin",r(e,!0)))}))}catch(e){throw console.error(e),e}finally{this.loader.disable()}}handlerClickSvgCell(e,t){const s=+e.target.closest("[data-room-id]").getAttribute("data-room-id");if(!s)return;const a=this.warehouse.querySelector(`.warehouse__svg-cell[data-room-id="${s}"]`),i=this.warehouse.querySelector(`.room-warehouse[data-room-id="${s}"]`),[n]=t.filter((e=>+e.room_id===s));if(n){if(a.classList.contains("_selected"))a&&a.classList.remove("_selected"),i&&i.classList.remove("_selected"),this.resultRoomsData.volume=+(this.resultRoomsData.volume-+n.volume).toFixed(1),this.resultRoomsData.price_11m=+(this.resultRoomsData.price_11m-+n.price_11m).toFixed(0),this.resultRoomsData.ids=this.resultRoomsData.ids.filter((e=>e!==n.room_id)),this.resultRoomsData.rooms=this.resultRoomsData.rooms.filter((e=>+e.room_id!=+n.room_id)),this.resultRoomsData.count_rooms-=1;else{const e=this.warehouse.querySelector(".not-filtered-rooms");e&&e.remove(),a&&a.classList.add("_selected"),i&&i.remove(),this.contentRoomsWarehouse.insertAdjacentHTML("afterbegin",r(n,!0)),this.resultRoomsData.volume=+(this.resultRoomsData.volume+ +n.volume).toFixed(1),this.resultRoomsData.price_11m=+(this.resultRoomsData.price_11m+ +n.price_11m).toFixed(0),this.resultRoomsData.ids.push(n.room_id),this.resultRoomsData.rooms.push(n),this.resultRoomsData.count_rooms+=1}1==this.resultRoomsData.count_rooms?(this.buttonResultWarehouse.setAttribute("data-room-id",this.resultRoomsData.ids[0]),this.buttonResultWarehouse.classList.remove("_none")):(this.buttonResultWarehouse.setAttribute("data-room-id",""),this.buttonResultWarehouse.classList.add("_none")),(0,g.B)(".warehouse__rooms_room-num",{breakpointsNone:576}),(0,g.B)(".warehouse__rooms_room-area",{breakpoints:[1215,576]}),(0,g.B)(".warehouse__rooms_room-block.dimensions",{breakpoints:[1215,576]}),(0,g.B)(".warehouse__rooms_room-link",{breakpoints:[576,370]}),this.infoResultWarehouse.innerHTML=`<span>${this.resultRoomsData.volume} м<sup>3</sup></span><span>от ${(0,o.F)(this.resultRoomsData.price_11m)}</span>`,this.linkResultWarehouse.innerHTML=`<span>Арендовать ${this.resultRoomsData.count_rooms}\n    ${(0,_.Y)(this.resultRoomsData.count_rooms,["кладовку","кладовки","кладовок"])}</span>`,this.linkResultWarehouse.href=`../rent-room.html?ids=${encodeURIComponent(JSON.stringify(this.resultRoomsData.ids))}`,document.querySelector(".warehouse__rooms").scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((()=>{this.contentRoomsWarehouse.scrollTo({top:0,left:0,behavior:"smooth"})}),600)}else console.error("Ячейка не найдена")}scrollToRoom(e){this.contentRoomsWarehouse.scrollHeight>=this.contentRoomsWarehouse.offsetHeight&&e&&this.contentRoomsWarehouse.scrollTo({top:e.offsetTop-this.contentRoomsWarehouse.offsetTop,left:0,behavior:"smooth"})}}}}]);